<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dag365 - Vecka, datum, namnsdag</title>
    <meta name="description" content="dag365 - Din dagliga √∂versikt med veckonummer, datum, namnsdag, soltider, v√§derprognos och OS 2026-schema. Installera som app och f√• push-notiser n√§r Sverige t√§vlar!">
    <meta name="keywords" content="veckonummer, datum, namnsdag, soltider, v√§der, OS 2026, Milano-Cortina, Sverige, kalender">
    <meta name="author" content="dag365">
    <meta property="og:title" content="dag365 - Vecka, datum, namnsdag">
    <meta property="og:description" content="Din dagliga √∂versikt med veckonummer, namnsdag, soltider och OS 2026-schema. F√• notiser n√§r Sverige t√§vlar!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dag365.se">
    <meta property="og:image" content="https://dag365.se/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://dag365.se/og-image.png">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f0f14">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="dag365">
    <link rel="apple-touch-icon" href="icon-192.png">
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 430px) and (device-height: 932px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 393px) and (device-height: 852px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 428px) and (device-height: 926px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 390px) and (device-height: 844px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 375px) and (device-height: 812px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 414px) and (device-height: 896px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 375px) and (device-height: 667px)">
    <link rel="apple-touch-startup-image" href="splash.svg" media="(device-width: 414px) and (device-height: 736px)">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f0f14;
            --card: #1a1a22;
            --card-hover: #22222d;
            --text: #e8e8ed;
            --muted: #6b6b7a;
            --blue: #4e8cff;
            --orange: #ff9f43;
            --green: #26de81;
            --pink: #ff6b9d;
            --red: #ff6b6b;
            --border: #2a2a35;
        }
        
        [data-theme="light"] {
            --bg: #f5f5f7;
            --card: #ffffff;
            --card-hover: #f0f0f2;
            --text: #1a1a1a;
            --muted: #6b6b7a;
            --blue: #2563eb;
            --orange: #ea580c;
            --green: #16a34a;
            --pink: #db2777;
            --red: #dc2626;
            --border: #e0e0e5;
        }
        
        [data-theme="light"] .week-widget {
            background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%);
        }
        
        [data-theme="light"] .date-widget {
            background: linear-gradient(135deg, #fce7f3 0%, #ffffff 100%);
        }
        
        [data-theme="light"] .nameday-widget {
            background: linear-gradient(135deg, #dcfce7 0%, #ffffff 100%);
        }
        
        [data-theme="light"] .weather-widget {
            background: linear-gradient(135deg, #cffafe 0%, #ffffff 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* Header */
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }
        
        .logo {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text);
        }
        
        .logo span {
            color: var(--blue);
        }
        
        .header-time {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .theme-toggle {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .theme-toggle:hover {
            border-color: var(--blue);
            background: var(--card-hover);
        }
        
        .install-btn {
            background: var(--blue);
            border: 1px solid var(--blue);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: 'DM Sans', sans-serif;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        
        .install-btn:hover {
            background: #3a7ae8;
            border-color: #3a7ae8;
        }
        
        .install-btn.show {
            display: flex;
        }

        #notify-btn {
            display: flex;
            background: var(--orange);
            border-color: var(--orange);
            transition: all 0.3s ease;
        }

        #notify-btn:hover {
            background: #e8903d;
            border-color: #e8903d;
        }

        #notify-btn.notify-active {
            background: var(--green);
            border-color: var(--green);
            animation: pulse-green 2s infinite;
        }

        #notify-btn.notify-active:hover {
            background: #20c374;
            border-color: #20c374;
        }

        #notify-btn.notify-denied {
            background: var(--muted);
            border-color: var(--muted);
            opacity: 0.6;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(38, 222, 129, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(38, 222, 129, 0); }
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .widget {
            background: var(--card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .widget:hover {
            background: var(--card-hover);
        }
        
        .widget-label {
            font-size: 0.7rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .widget-label .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        /* Week Widget */
        .week-widget {
            grid-column: span 2;
            grid-row: span 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #1e3a5f 0%, #1a1a22 100%);
        }
        
        .week-widget .dot { background: var(--blue); }
        
        .week-number {
            font-family: 'Space Mono', monospace;
            font-size: 5rem;
            font-weight: 700;
            color: var(--blue);
            line-height: 1;
        }
        
        .week-text {
            font-size: 1rem;
            color: var(--muted);
            margin-top: 0.5rem;
        }
        
        /* Date Widget */
        .date-widget {
            grid-column: span 4;
            background: linear-gradient(135deg, #2d1f3d 0%, #1a1a22 100%);
        }
        
        .date-widget .dot { background: var(--pink); }
        
        .date-main {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .date-sub {
            font-size: 1rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }
        
        /* Nameday Widget */
        .nameday-widget {
            grid-column: span 4;
            background: linear-gradient(135deg, #1f2d1f 0%, #1a1a22 100%);
        }
        
        .nameday-widget .dot { background: var(--green); }
        
        .nameday-names {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--green);
        }
        
        .nameday-tomorrow {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 0.5rem;
        }
        
        /* Sun Widget */
        .sun-widget {
            grid-column: span 3;
        }
        
        .sun-widget .dot { background: var(--orange); }
        
        /* Weather Widget - 3-day forecast */
        .weather-widget {
            grid-column: span 3;
            background: linear-gradient(135deg, #1a3a4a 0%, #1a1a22 100%);
        }
        
        .weather-widget .dot { background: #4ecdc4; }
        
        .location-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .location-selector select {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
        }
        
        .location-selector select:hover,
        .location-selector select:focus {
            border-color: #4ecdc4;
            outline: none;
        }
        
        .location-selector button {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .location-selector button:hover {
            border-color: #4ecdc4;
            background: var(--card-hover);
        }
        
        .location-selector button.loading {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        
        .forecast-day {
            text-align: center;
            padding: 0.5rem;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        
        .forecast-day:first-child {
            border-color: rgba(78, 205, 196, 0.3);
            background: rgba(78, 205, 196, 0.08);
        }
        
        .forecast-day-name {
            font-size: 0.7rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.4rem;
        }
        
        .forecast-day:first-child .forecast-day-name {
            color: #4ecdc4;
        }
        
        .forecast-icon {
            font-size: 1.8rem;
            line-height: 1;
            margin-bottom: 0.3rem;
        }
        
        .forecast-temps {
            display: flex;
            justify-content: center;
            gap: 0.4rem;
            align-items: baseline;
        }
        
        .forecast-temp-high {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
        }
        
        .forecast-temp-low {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--muted);
        }
        
        .forecast-details {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.3rem;
            font-size: 0.65rem;
            color: var(--muted);
        }
        
        .forecast-detail {
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        
        .forecast-detail-icon {
            font-size: 0.7rem;
        }
        
        .sun-times {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .sun-item { text-align: center; }
        
        .sun-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .sun-time {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .sun-label {
            font-size: 0.65rem;
            color: var(--muted);
            text-transform: uppercase;
        }
        
        .daylight-bar {
            margin-top: 1rem;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .daylight-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--orange), #ffd93d);
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        .daylight-text {
            font-size: 0.7rem;
            color: var(--muted);
            margin-top: 0.5rem;
        }
        
        /* Stats Widget */
        .stats-widget {
            grid-column: span 3;
        }
        
        .stats-widget .dot { background: var(--pink); }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .stat-row:last-child { border-bottom: none; }
        
        .stat-label {
            color: var(--muted);
            font-size: 0.85rem;
        }
        
        .stat-value {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
        }
        
        /* Holidays Widget */
        .holidays-widget {
            grid-column: span 3;
        }
        
        .holidays-widget .dot { background: var(--red); }
        
        .holiday-item {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }
        
        .holiday-item:last-child { border-bottom: none; }
        
        .holiday-name {
            color: var(--text);
        }
        
        .holiday-date {
            color: var(--muted);
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
        }
        
        /* Themeday Widget */
        .themeday-widget {
            grid-column: span 3;
            background: linear-gradient(135deg, #3d2d1f 0%, #1a1a22 100%);
        }
        
        .themeday-widget .dot { background: #f4a460; }
        
        .themeday-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .themeday-icon {
            font-size: 2rem;
        }
        
        .themeday-name {
            font-size: 1.1rem;
            font-weight: 500;
            color: #f4a460;
        }
        
        [data-theme="light"] .themeday-widget {
            background: linear-gradient(135deg, #fef3c7 0%, #ffffff 100%);
        }
        
        /* Calendar themeday marker */
        .day-cell.themeday {
            position: relative;
        }
        
        .day-cell.themeday::after {
            content: '';
            position: absolute;
            bottom: 1px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #f4a460;
            border-radius: 50%;
        }
        
        .day-cell.today.themeday::after {
            background: white;
        }
        
        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .section-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
        }
        
        .section-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .section-nav button {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .section-nav button:hover {
            background: var(--card-hover);
            border-color: var(--blue);
        }
        
        .section-nav button.active {
            background: var(--blue);
            border-color: var(--blue);
        }
        
        /* Year Calendar */
        .year-calendar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .month-card {
            background: var(--card);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border);
        }
        
        .month-card.current {
            border-color: var(--blue);
            box-shadow: 0 0 20px rgba(78, 140, 255, 0.1);
        }
        
        .month-name {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            color: var(--text);
        }
        
        .month-card.current .month-name {
            color: var(--blue);
        }
        
        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 4px;
        }
        
        .weekday-header span {
            font-size: 0.55rem;
            color: var(--muted);
            text-align: center;
        }
        
        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        
        .month-with-weeks {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 4px;
        }
        
        .week-numbers {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding-top: 0;
        }
        
        .week-num {
            font-size: 0.55rem;
            color: var(--muted);
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc((100% - 10px) / 6);
            min-height: 18px;
            opacity: 0.7;
        }
        
        .month-days {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        
        .day-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            border-radius: 4px;
            color: var(--text);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .day-cell:active:not(.empty) {
            transform: scale(0.9);
        }

        .day-cell.empty {
            visibility: hidden;
            cursor: default;
        }

        /* Day info popup */
        .day-info-popup {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            text-align: center;
            max-width: 90vw;
        }

        .day-info-popup.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .day-info-popup .date {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .day-info-popup .info {
            font-size: 0.95rem;
            color: var(--muted);
        }

        .day-info-popup .holiday-text {
            color: var(--red);
            font-weight: 500;
        }

        .day-info-popup .themeday-text {
            color: var(--orange);
        }
        
        .day-cell.today {
            background: var(--blue);
            color: white;
            font-weight: 700;
        }
        
        .day-cell.holiday {
            color: var(--red);
        }
        
        .day-cell.sunday {
            color: var(--red);
            opacity: 0.7;
        }
        
        .day-cell.weekend {
            opacity: 0.6;
        }
        
        /* News Widget */
        .news-section {
            margin-top: 2rem;
        }
        
        /* History Section */
        .history-section {
            margin-top: 2rem;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .history-card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .history-card:hover {
            background: var(--card-hover);
            border-color: var(--orange);
        }
        
        .history-card a {
            text-decoration: none;
            color: inherit;
        }
        
        .history-year {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--orange);
            margin-bottom: 0.5rem;
        }
        
        .history-text {
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--text);
        }
        
        .history-filter {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-filter:hover {
            color: var(--text);
            border-color: var(--orange);
        }
        
        .history-filter.active {
            background: var(--orange);
            border-color: var(--orange);
            color: white;
        }
        
        @media (max-width: 700px) {
            .history-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .news-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .news-card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .news-card:hover {
            background: var(--card-hover);
            border-color: var(--blue);
        }
        
        .news-card a {
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .news-card a:hover .news-title {
            color: var(--blue);
        }
        
        .news-filter {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .news-filter:hover {
            color: var(--text);
            border-color: var(--blue);
        }
        
        .news-filter.active {
            background: var(--blue);
            border-color: var(--blue);
            color: white;
        }
        
        .news-source {
            font-size: 0.65rem;
            color: var(--blue);
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .news-title {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .news-time {
            font-size: 0.7rem;
            color: var(--muted);
            margin-top: 0.75rem;
        }
        
        /* Quote Section */
        .quote-section {
            margin-top: 2rem;
        }
        
        .quote-card {
            background: linear-gradient(135deg, #1f2d3d 0%, var(--card) 100%);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        [data-theme="light"] .quote-card {
            background: linear-gradient(135deg, #e0e7ff 0%, var(--card) 100%);
        }
        
        .quote-card::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 8rem;
            font-family: Georgia, serif;
            color: var(--blue);
            opacity: 0.1;
            line-height: 1;
        }
        
        .quote-text {
            font-size: 1.25rem;
            line-height: 1.6;
            color: var(--text);
            font-style: italic;
            position: relative;
            z-index: 1;
            margin-bottom: 1rem;
        }
        
        .quote-author {
            font-size: 0.9rem;
            color: var(--blue);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .quote-author::before {
            content: '‚Äî';
            color: var(--muted);
        }
        
        .quote-meta {
            font-size: 0.75rem;
            color: var(--muted);
            margin-left: 0.5rem;
        }
        
        .quote-nav {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .quote-nav button {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        
        .quote-nav button:hover {
            border-color: var(--blue);
            background: var(--card-hover);
        }
        
        .quote-counter {
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--muted);
            font-family: 'Space Mono', monospace;
            align-self: center;
        }
        
        @media (max-width: 700px) {
            .quote-text {
                font-size: 1.1rem;
            }
            .quote-card {
                padding: 1.5rem;
            }
        }
        
        /* Olympics Section */
        .olympics-section {
            margin-top: 2rem;
        }

        .olympics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .olympics-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .olympics-card:hover {
            background: var(--card-hover);
            border-color: #ffd700;
        }

        .olympics-card.live {
            border-color: #ff4444;
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.1) 0%, var(--card) 100%);
            animation: pulse-live 2s infinite;
        }

        .olympics-card.today {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, var(--card) 100%);
        }

        @keyframes pulse-live {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(255, 68, 68, 0); }
        }

        .olympics-date {
            font-size: 0.65rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.3rem;
        }

        .olympics-time {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--blue);
            margin-bottom: 0.3rem;
        }

        .olympics-card.live .olympics-time {
            color: #ff4444;
        }

        .olympics-card.live .olympics-time::before {
            content: 'üî¥ LIVE ';
            font-size: 0.8rem;
        }

        .olympics-sport {
            font-size: 0.7rem;
            color: var(--muted);
            margin-bottom: 0.25rem;
        }

        .olympics-event {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text);
            line-height: 1.3;
        }

        .olympics-filter {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }

        .olympics-filter:hover,
        .olympics-filter.active {
            border-color: #ffd700;
            color: var(--text);
            background: var(--card-hover);
        }

        .olympics-nav {
            flex-wrap: wrap;
            gap: 0.3rem;
        }

        .olympics-date-select {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }

        .olympics-date-select:hover,
        .olympics-date-select:focus {
            border-color: #ffd700;
            outline: none;
        }

        .olympics-actions {
            margin-top: 1rem;
            text-align: center;
        }

        .olympics-toggle {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }

        .olympics-toggle:hover {
            border-color: #ffd700;
            background: var(--card-hover);
        }

        .olympics-grid.expanded {
            grid-template-columns: repeat(4, 1fr);
        }

        .olympics-card .notify-toggle {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            opacity: 0.4;
            transition: all 0.2s;
            padding: 0.2rem;
        }

        .olympics-card .notify-toggle:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .olympics-card .notify-toggle.active {
            opacity: 1;
        }

        .olympics-card {
            position: relative;
        }

        @media (max-width: 900px) {
            .olympics-grid.expanded {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 700px) {
            .olympics-grid {
                grid-template-columns: 1fr;
            }
            .olympics-grid.expanded {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .olympics-grid.expanded {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem 0 1rem;
            font-size: 0.7rem;
            color: var(--muted);
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
        
        /* Responsive */
        @media (max-width: 900px) {
            .year-calendar {
                grid-template-columns: repeat(3, 1fr);
            }
            .news-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 700px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
            .week-widget,
            .date-widget,
            .nameday-widget,
            .sun-widget,
            .weather-widget,
            .stats-widget,
            .holidays-widget,
            .themeday-widget {
                grid-column: span 2;
            }
            .week-widget {
                grid-row: span 1;
                padding: 2rem;
            }
            .week-number {
                font-size: 3.5rem;
            }
            .year-calendar {
                grid-template-columns: repeat(2, 1fr);
            }
            .news-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 500px) {
            .year-calendar {
                display: flex;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
                gap: 1rem;
                padding-bottom: 1rem;
            }
            .year-calendar::-webkit-scrollbar {
                display: none;
            }
            .year-calendar {
                scrollbar-width: none;
            }
            .month-card {
                flex: 0 0 85%;
                scroll-snap-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="site-header">
            <div class="logo">dag<span>365</span></div>
            <div class="header-right">
                <button id="notify-btn" class="install-btn" title="Klicka f√∂r att aktivera OS-notiser">üîî Aktivera notiser</button>
                <button id="install-btn" class="install-btn" title="Installera app">üì≤ Installera</button>
                <button id="theme-toggle" class="theme-toggle" title="Byt tema">üåô</button>
                <div class="header-time" id="clock">--:--:--</div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="widget week-widget">
                <div class="widget-label"><span class="dot"></span>Vecka</div>
                <div class="week-number" id="week-number">--</div>
                <div class="week-text" id="week-text">av 52</div>
            </div>
            
            <div class="widget date-widget">
                <div class="widget-label"><span class="dot"></span>Idag</div>
                <div class="date-main" id="date-main">Laddar...</div>
                <div class="date-sub" id="date-sub"></div>
            </div>
            
            <div class="widget nameday-widget">
                <div class="widget-label"><span class="dot"></span>Namnsdag</div>
                <div class="nameday-names" id="nameday">Laddar...</div>
                <div class="nameday-tomorrow" id="nameday-tomorrow"></div>
            </div>
            
            <div class="widget sun-widget">
                <div class="widget-label"><span class="dot"></span>Sol</div>
                <div class="sun-times">
                    <div class="sun-item">
                        <div class="sun-icon">‚òÄÔ∏è</div>
                        <div class="sun-time" id="sunrise">--:--</div>
                        <div class="sun-label">Upp</div>
                    </div>
                    <div class="sun-item">
                        <div class="sun-icon">üåô</div>
                        <div class="sun-time" id="sunset">--:--</div>
                        <div class="sun-label">Ner</div>
                    </div>
                </div>
                <div class="daylight-bar">
                    <div class="daylight-fill" id="daylight-bar"></div>
                </div>
                <div class="daylight-text" id="daylight-text">-- dagsljus</div>
            </div>
            
            <div class="widget weather-widget">
                <div class="widget-label"><span class="dot"></span>V√§derprognos</div>
                <div class="location-selector">
                    <select id="city-select">
                        <option value="stockholm">Stockholm</option>
                        <option value="goteborg">G√∂teborg</option>
                        <option value="malmo">Malm√∂</option>
                        <option value="uppsala">Uppsala</option>
                        <option value="linkoping">Link√∂ping</option>
                        <option value="orebro">√ñrebro</option>
                        <option value="vasteras">V√§ster√•s</option>
                        <option value="norrkoping">Norrk√∂ping</option>
                        <option value="jonkoping">J√∂nk√∂ping</option>
                        <option value="umea">Ume√•</option>
                        <option value="lulea">Lule√•</option>
                        <option value="sundsvall">Sundsvall</option>
                        <option value="karlstad">Karlstad</option>
                        <option value="gavle">G√§vle</option>
                        <option value="vaxjo">V√§xj√∂</option>
                    </select>
                    <button id="geolocation-btn" title="Anv√§nd min position">üìç</button>
                </div>
                <div class="forecast-grid" id="forecast-grid">
                    <div class="forecast-day">
                        <div class="forecast-day-name">Laddar...</div>
                        <div class="forecast-icon">‚è≥</div>
                        <div class="forecast-temps">
                            <span class="forecast-temp-high">--¬∞</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="widget stats-widget">
                <div class="widget-label"><span class="dot"></span>√Ör <span id="current-year">2025</span></div>
                <div class="stat-row">
                    <span class="stat-label">Dag</span>
                    <span class="stat-value" id="day-of-year">-- / 365</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Kvar</span>
                    <span class="stat-value" id="days-left">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Progress</span>
                    <span class="stat-value" id="year-progress">--%</span>
                </div>
            </div>
            
            <div class="widget themeday-widget" id="themeday-widget" style="display: none;">
                <div class="widget-label"><span class="dot"></span>Idag firas ocks√•</div>
                <div class="themeday-content">
                    <span class="themeday-icon" id="themeday-icon">üéâ</span>
                    <span class="themeday-name" id="themeday-name">-</span>
                </div>
            </div>
        </div>

        <div class="olympics-section">
            <div class="section-header">
                <h2 class="section-title">üá∏üá™ OS Milano-Cortina 2026</h2>
                <div class="section-nav olympics-nav">
                    <button class="olympics-filter active" data-sport="all">Alla</button>
                    <button class="olympics-filter" data-sport="hockey">üèí</button>
                    <button class="olympics-filter" data-sport="curling">ü•å</button>
                    <button class="olympics-filter" data-sport="skiing">‚õ∑Ô∏è</button>
                    <button class="olympics-filter" data-sport="biathlon">üéØ</button>
                    <button class="olympics-filter" data-sport="alpine">üèîÔ∏è</button>
                    <button class="olympics-filter" data-sport="freestyle">üéø</button>
                    <button class="olympics-filter" data-sport="snowboard">üèÇ</button>
                    <button class="olympics-filter" data-sport="jumping">ü¶Ö</button>
                    <button class="olympics-filter" data-sport="figureskating">‚õ∏Ô∏è</button>
                    <button class="olympics-filter" data-sport="luge">üõ∑</button>
                    <select id="olympics-date-filter" class="olympics-date-select">
                        <option value="all">Alla dagar</option>
                    </select>
                </div>
            </div>
            <div class="olympics-grid" id="olympics-grid">
                <div class="olympics-card">
                    <div class="olympics-time">‚è≥</div>
                    <div class="olympics-event">Laddar OS-schema...</div>
                </div>
            </div>
            <div class="olympics-actions">
                <button id="olympics-show-all" class="olympics-toggle">Visa hela schemat ‚ñº</button>
            </div>
        </div>

        <div class="section-header">
            <h2 class="section-title">√Örskalender <span id="calendar-year">2025</span></h2>
            <div class="section-nav">
                <button id="prev-year">‚Üê F√∂rra</button>
                <button id="current-year-btn" class="active">I √•r</button>
                <button id="next-year">N√§sta ‚Üí</button>
            </div>
        </div>
        
        <div class="year-calendar" id="year-calendar">
            <!-- Generated by JS -->
        </div>
        
        <div class="history-section">
            <div class="section-header">
                <h2 class="section-title">Denna dag i historien</h2>
                <div class="section-nav">
                    <button class="history-filter active" data-type="events">H√§ndelser</button>
                    <button class="history-filter" data-type="births">F√∂dda</button>
                    <button class="history-filter" data-type="deaths">D√∂da</button>
                </div>
            </div>
            <div class="history-grid" id="history-grid">
                <div class="history-card">
                    <div class="history-year">‚è≥</div>
                    <div class="history-text">Laddar historiska h√§ndelser...</div>
                </div>
            </div>
        </div>
        
        <div class="quote-section">
            <div class="section-header">
                <h2 class="section-title">üí¨ Dagens citat</h2>
            </div>
            <div class="quote-card">
                <div class="quote-text" id="quote-text">Laddar citat...</div>
                <div class="quote-author" id="quote-author"></div>
                <div class="quote-nav">
                    <button id="prev-quote">‚Üê F√∂reg√•ende</button>
                    <button id="next-quote">N√§sta ‚Üí</button>
                    <button id="random-quote">üé≤ Slumpa</button>
                    <span class="quote-counter" id="quote-counter">1/50</span>
                </div>
            </div>
        </div>

        <div class="news-section">
            <div class="section-header">
                <h2 class="section-title">Nyheter</h2>
                <div class="section-nav">
                    <button class="news-filter active" data-source="all">Alla</button>
                    <button class="news-filter" data-source="svt">SVT</button>
                    <button class="news-filter" data-source="sr">SR</button>
                    <button class="news-filter" data-source="feber">Feber</button>
                </div>
            </div>
            <div class="news-grid" id="news-grid">
                <div class="news-card">
                    <div class="news-source">Laddar</div>
                    <div class="news-title">H√§mtar nyheter...</div>
                    <div class="news-time">‚è≥</div>
                </div>
            </div>
        </div>
        
        <footer>
            dag365 ‚Äî Snabb. Ren. Svensk.
        </footer>
    </div>
    
    <script>
        // Swedish namedays data (complete for all 366 days)
        const namedays = {
            "01-01": ["Ny√•rsdagen"],
            "01-02": ["Svea", "Sverker"],
            "01-03": ["Alfred", "Alfrida"],
            "01-04": ["Rut", "Ritva"],
            "01-05": ["Hanna", "Hannele"],
            "01-06": ["Kasper", "Melker", "Baltsar"],
            "01-07": ["August", "Augusta"],
            "01-08": ["Erland", "Erlendur"],
            "01-09": ["Gunnar", "Gunder"],
            "01-10": ["Sigurd", "Sigbritt"],
            "01-11": ["Jan", "Jansen"],
            "01-12": ["Frideborg", "Fridolf"],
            "01-13": ["Knut"],
            "01-14": ["Felix", "Felicia"],
            "01-15": ["Laura", "Lorentz"],
            "01-16": ["Hjalmar", "Helmer"],
            "01-17": ["Anton", "Tony"],
            "01-18": ["Hilda", "Hildur"],
            "01-19": ["Henrik", "Henry"],
            "01-20": ["Fabian", "Sebastian"],
            "01-21": ["Agnes", "Agneta"],
            "01-22": ["Vincent", "Viktor"],
            "01-23": ["Frej", "Freja"],
            "01-24": ["Erika", "Eira"],
            "01-25": ["Paul", "P√•l"],
            "01-26": ["Bodil", "Boel"],
            "01-27": ["G√∂te", "G√∂ta"],
            "01-28": ["Karl", "Karla"],
            "01-29": ["Diana", "Diana"],
            "01-30": ["Gunilla", "Gunhild"],
            "01-31": ["Ivar", "Joar"],
            "02-01": ["Max", "Maximilian"],
            "02-02": ["Kyndelsm√§ssodagen"],
            "02-03": ["Disa", "Hj√∂rdis"],
            "02-04": ["Ansgar", "Anselm"],
            "02-05": ["Agata", "Agda"],
            "02-06": ["Dorotea", "Doris"],
            "02-07": ["Rikard", "Dick"],
            "02-08": ["Berta", "Bert"],
            "02-09": ["Fanny", "Franciska"],
            "02-10": ["Egon", "Egil"],
            "02-11": ["Yngve", "Inge"],
            "02-12": ["Evelina", "Evy"],
            "02-13": ["Agne", "Ove"],
            "02-14": ["Valentin", "Tina"],
            "02-15": ["Sigfrid", "Sigbritt"],
            "02-16": ["Julia", "Juliana"],
            "02-17": ["Alexandra", "Sandra"],
            "02-18": ["Frida", "Fritiof"],
            "02-19": ["Gabriella", "Ella"],
            "02-20": ["Vivianne", "Viveka"],
            "02-21": ["Hilding", "Hulda"],
            "02-22": ["Pia", "Marina"],
            "02-23": ["Torsten", "Torun"],
            "02-24": ["Mattias", "Mats"],
            "02-25": ["Sigvard", "Sivert"],
            "02-26": ["Torgny", "Torkel"],
            "02-27": ["Lage", "Laila"],
            "02-28": ["Maria", "Maja"],
            "02-29": ["Skottdagen"],
            "03-01": ["Albin", "Elvira"],
            "03-02": ["Ernst", "Erna"],
            "03-03": ["Gunborg", "Gunvor"],
            "03-04": ["Adrian", "Adriana"],
            "03-05": ["Tora", "Tove"],
            "03-06": ["Ebba", "Ebbe"],
            "03-07": ["Camilla", "Isadora"],
            "03-08": ["Siv", "Saga"],
            "03-09": ["Torbj√∂rn", "Torleif"],
            "03-10": ["Edla", "Ada"],
            "03-11": ["Edvin", "Egon"],
            "03-12": ["Viktoria", "Viktor"],
            "03-13": ["Greger", "Greta"],
            "03-14": ["Matilda", "Maud"],
            "03-15": ["Kristoffer", "Christel"],
            "03-16": ["Herbert", "Gilbert"],
            "03-17": ["Gertrud", "G√∂rel"],
            "03-18": ["Edvard", "Edmund"],
            "03-19": ["Josef", "Josefina"],
            "03-20": ["Joakim", "Kim"],
            "03-21": ["Bengt", "Benny"],
            "03-22": ["Kennet", "Kent"],
            "03-23": ["Gerda", "Gerd"],
            "03-24": ["Gabriel", "Rafael"],
            "03-25": ["Marie", "Beb√•delsedag"],
            "03-26": ["Emanuel", "Manne"],
            "03-27": ["Rudolf", "Ralf"],
            "03-28": ["Malkolm", "Morgan"],
            "03-29": ["Jonas", "Jens"],
            "03-30": ["Holger", "Holmfrid"],
            "03-31": ["Ester", "Estrid"],
            "04-01": ["Harald", "Hervor"],
            "04-02": ["Gudmund", "Ingemund"],
            "04-03": ["Ferdinand", "Nanna"],
            "04-04": ["Marianne", "Marlene"],
            "04-05": ["Irene", "Irja"],
            "04-06": ["Vilhelm", "Helmi"],
            "04-07": ["Irma", "Irmelin"],
            "04-08": ["Nadja", "Tanja"],
            "04-09": ["Otto", "Ottilia"],
            "04-10": ["Ingvar", "Ingvor"],
            "04-11": ["Ulf", "Ylva"],
            "04-12": ["Liv", "Livia"],
            "04-13": ["Artur", "Douglas"],
            "04-14": ["Tiburtius", "Tim"],
            "04-15": ["Olivia", "Oliver"],
            "04-16": ["Patrik", "Patricia"],
            "04-17": ["Elias", "Elis"],
            "04-18": ["Valdemar", "Volmar"],
            "04-19": ["Olaus", "Ola"],
            "04-20": ["Amalia", "Amelie"],
            "04-21": ["Anneli", "Annika"],
            "04-22": ["Allan", "Alida"],
            "04-23": ["Georg", "G√∂ran"],
            "04-24": ["Vega", "Viveka"],
            "04-25": ["Markus", "Mark"],
            "04-26": ["Teresia", "Terese"],
            "04-27": ["Engelbrekt", "Enok"],
            "04-28": ["Ture", "Tyra"],
            "04-29": ["Tyko", "Tim"],
            "04-30": ["Mariana", "Marianne"],
            "05-01": ["Valborg", "F√∂rsta maj"],
            "05-02": ["Filip", "Filippa"],
            "05-03": ["John", "Jane"],
            "05-04": ["Monika", "Mona"],
            "05-05": ["Gotthard", "Erhard"],
            "05-06": ["Marit", "Rita"],
            "05-07": ["Carina", "Carita"],
            "05-08": ["√Öke", "Ove"],
            "05-09": ["Reidar", "Reidun"],
            "05-10": ["Esbj√∂rn", "Styrbj√∂rn"],
            "05-11": ["M√§rta", "M√§rit"],
            "05-12": ["Charlotta", "Lotta"],
            "05-13": ["Linnea", "Linn"],
            "05-14": ["Halvard", "Halvar"],
            "05-15": ["Sofia", "Sonja"],
            "05-16": ["Ronald", "Ronny"],
            "05-17": ["Rebecka", "Ruben"],
            "05-18": ["Erik", "Eriksdagen"],
            "05-19": ["Maj", "Majken"],
            "05-20": ["Karolina", "Carola"],
            "05-21": ["Konstantin", "Conny"],
            "05-22": ["Hemming", "Henning"],
            "05-23": ["Desideria", "Desiree"],
            "05-24": ["Ivan", "Vanja"],
            "05-25": ["Urban", "Ursula"],
            "05-26": ["Vilhelmina", "Vilma"],
            "05-27": ["Beda", "Blenda"],
            "05-28": ["Ingeborg", "Borghild"],
            "05-29": ["Yvonne", "Jansen"],
            "05-30": ["Vera", "Veronika"],
            "05-31": ["Petronella", "Pernilla"],
            "06-01": ["Gun", "Gunnel"],
            "06-02": ["Rutger", "Roger"],
            "06-03": ["Ingemar", "Gudmar"],
            "06-04": ["Solbritt", "Solveig"],
            "06-05": ["Bo", "Boris"],
            "06-06": ["Gustaf", "Nationaldagen"],
            "06-07": ["Robert", "Robin"],
            "06-08": ["Eivor", "Evor"],
            "06-09": ["B√∂rje", "Birger"],
            "06-10": ["Svante", "Boris"],
            "06-11": ["Bertil", "Berthold"],
            "06-12": ["Eskil", "Eskilsdagen"],
            "06-13": ["Aina", "Eina"],
            "06-14": ["H√•kan", "Heikki"],
            "06-15": ["Margit", "Margot"],
            "06-16": ["Axel", "Axelina"],
            "06-17": ["Torborg", "Torvald"],
            "06-18": ["Bj√∂rn", "Bjarne"],
            "06-19": ["Germund", "G√∂rel"],
            "06-20": ["Linda", "Linn"],
            "06-21": ["Alf", "Alva"],
            "06-22": ["Paulina", "Paula"],
            "06-23": ["Adolf", "Adolfa"],
            "06-24": ["Johannes D√∂parens dag"],
            "06-25": ["David", "Salomon"],
            "06-26": ["Rakel", "Lea"],
            "06-27": ["Selma", "Fingal"],
            "06-28": ["Leo", "Leopold"],
            "06-29": ["Petrus", "Peter"],
            "06-30": ["Elof", "Leif"],
            "07-01": ["Aron", "Mirjam"],
            "07-02": ["Rosa", "Rosita"],
            "07-03": ["Aurora", "Adina"],
            "07-04": ["Ulrika", "Ulla"],
            "07-05": ["Laila", "Ritva"],
            "07-06": ["Esaias", "Jessika"],
            "07-07": ["Klas", "Kaj"],
            "07-08": ["Kjell", "Tjelvar"],
            "07-09": ["J√∂rgen", "√ñrjan"],
            "07-10": ["Andr√©", "Andrea"],
            "07-11": ["Eleonora", "Ellinor"],
            "07-12": ["Herman", "Hermine"],
            "07-13": ["Joel", "Judit"],
            "07-14": ["Folke", "Odd"],
            "07-15": ["Ragnhild", "Ragnvald"],
            "07-16": ["Reinhold", "Reine"],
            "07-17": ["Bruno", "Alexis"],
            "07-18": ["Fredrik", "Fritz"],
            "07-19": ["Sara", "Sally"],
            "07-20": ["Margareta", "Greta"],
            "07-21": ["Johanna", "Jane"],
            "07-22": ["Magdalena", "Madeleine"],
            "07-23": ["Emma", "Emmy"],
            "07-24": ["Kristina", "Kerstin"],
            "07-25": ["Jakob", "James"],
            "07-26": ["Jesper", "Jessika"],
            "07-27": ["Marta", "Moa"],
            "07-28": ["Botvid", "Seved"],
            "07-29": ["Olof", "Olle"],
            "07-30": ["Algot", "Margot"],
            "07-31": ["Helena", "Elin"],
            "08-01": ["Per", "P√§r"],
            "08-02": ["Karin", "Kajsa"],
            "08-03": ["Tage", "Tanja"],
            "08-04": ["Arne", "Arnold"],
            "08-05": ["Ulrik", "Alrik"],
            "08-06": ["Alfons", "Inez"],
            "08-07": ["Dennis", "Denise"],
            "08-08": ["Silvia", "Sylvia"],
            "08-09": ["Roland", "Roine"],
            "08-10": ["Lars", "Lorentz"],
            "08-11": ["Susanna", "Sanna"],
            "08-12": ["Klara", "Clary"],
            "08-13": ["Kaj", "Kaisa"],
            "08-14": ["Uno", "Unn"],
            "08-15": ["Stella", "Estelle"],
            "08-16": ["Brynolf", "Sigyn"],
            "08-17": ["Verner", "Valter"],
            "08-18": ["Ellen", "Lena"],
            "08-19": ["Magnus", "M√•ns"],
            "08-20": ["Bernhard", "Bernt"],
            "08-21": ["Jon", "Jansen"],
            "08-22": ["Henrietta", "Henrika"],
            "08-23": ["Signe", "Signhild"],
            "08-24": ["Bartolomeus", "Bert"],
            "08-25": ["Lovisa", "Louise"],
            "08-26": ["√ñsten", "Ejvor"],
            "08-27": ["Rolf", "Raoul"],
            "08-28": ["Fatima", "Leila"],
            "08-29": ["Hans", "Hampus"],
            "08-30": ["Albert", "Albertina"],
            "08-31": ["Arvid", "Vidar"],
            "09-01": ["Sam", "Samuel"],
            "09-02": ["Justus", "Justina"],
            "09-03": ["Alfhild", "Alva"],
            "09-04": ["Gisela", "Selma"],
            "09-05": ["Adela", "Heidi"],
            "09-06": ["Lilian", "Lilly"],
            "09-07": ["Kevin", "Roy"],
            "09-08": ["Alma", "Hulda"],
            "09-09": ["Anita", "Annette"],
            "09-10": ["Tord", "Turid"],
            "09-11": ["Dagny", "Helny"],
            "09-12": ["√Ösa", "√Ösl√∂g"],
            "09-13": ["Sture", "Styrbj√∂rn"],
            "09-14": ["Ida", "Ellida"],
            "09-15": ["Sigrid", "Siri"],
            "09-16": ["Dag", "Daga"],
            "09-17": ["Hildegard", "Magnhild"],
            "09-18": ["Orvar", "Alvar"],
            "09-19": ["Fredrika", "Carita"],
            "09-20": ["Elise", "Lisa"],
            "09-21": ["Matteus", "Mats"],
            "09-22": ["Maurits", "Moritz"],
            "09-23": ["Tekla", "Tea"],
            "09-24": ["Gerhard", "Gert"],
            "09-25": ["Tryggve", "Trygve"],
            "09-26": ["Enar", "Einar"],
            "09-27": ["Dagmar", "Rigmor"],
            "09-28": ["Lennart", "Leonard"],
            "09-29": ["Mikael", "Mikaela"],
            "09-30": ["Helge", "Helny"],
            "10-01": ["Ragnar", "Ragna"],
            "10-02": ["Ludvig", "Louis"],
            "10-03": ["Evald", "Osvald"],
            "10-04": ["Frans", "Frank"],
            "10-05": ["Bror", "Bruno"],
            "10-06": ["Jenny", "Jennifer"],
            "10-07": ["Birgitta", "Britta"],
            "10-08": ["Nils", "Nelly"],
            "10-09": ["Ingrid", "Inger"],
            "10-10": ["Harry", "Harriet"],
            "10-11": ["Erling", "Jarl"],
            "10-12": ["Valfrid", "Manfred"],
            "10-13": ["Berit", "Birgit"],
            "10-14": ["Stellan", "Sten"],
            "10-15": ["Hedvig", "Hillevi"],
            "10-16": ["Finn", "Finlay"],
            "10-17": ["Antonia", "Antoinette"],
            "10-18": ["Lukas", "Lukina"],
            "10-19": ["Tore", "Torsten"],
            "10-20": ["Sibylla", "Camilla"],
            "10-21": ["Ursula", "Yrsa"],
            "10-22": ["Marika", "Marita"],
            "10-23": ["Severin", "S√∂ren"],
            "10-24": ["Evert", "Eilert"],
            "10-25": ["Inga", "Ingalill"],
            "10-26": ["Amanda", "Rasmus"],
            "10-27": ["Sabina", "Ina"],
            "10-28": ["Simon", "Simone"],
            "10-29": ["Viola", "Vivi"],
            "10-30": ["Elsa", "Isabella"],
            "10-31": ["Edit", "Edgar"],
            "11-01": ["Allhelgonadagen"],
            "11-02": ["Tobias", "Toini"],
            "11-03": ["Hubert", "Hugo"],
            "11-04": ["Sverker", "Erker"],
            "11-05": ["Eugen", "Eugenia"],
            "11-06": ["Gustav Adolf"],
            "11-07": ["Ingegerd", "Ingela"],
            "11-08": ["Vendela", "Vanda"],
            "11-09": ["Teodor", "Teodora"],
            "11-10": ["Martin", "Martina"],
            "11-11": ["M√•rten", "M√•rtens dag"],
            "11-12": ["Konrad", "Kurt"],
            "11-13": ["Kristian", "Krister"],
            "11-14": ["Emil", "Emilia"],
            "11-15": ["Leopold", "Leopolda"],
            "11-16": ["Vibeke", "Viveka"],
            "11-17": ["Naemi", "Naima"],
            "11-18": ["Lillemor", "Moa"],
            "11-19": ["Elisabet", "Lisbet"],
            "11-20": ["Pontus", "Pia"],
            "11-21": ["Helga", "Olga"],
            "11-22": ["Cecilia", "Sissela"],
            "11-23": ["Klemens", "Clarence"],
            "11-24": ["Gudrun", "Rune"],
            "11-25": ["Katarina", "Katja"],
            "11-26": ["Linus", "Love"],
            "11-27": ["Astrid", "Asta"],
            "11-28": ["Malte", "Malt"],
            "11-29": ["Sune", "Synn√∂ve"],
            "11-30": ["Andreas", "Anders"],
            "12-01": ["Oskar", "Ossian"],
            "12-02": ["Beata", "Beatrice"],
            "12-03": ["Lydia", "Cornelia"],
            "12-04": ["Barbara", "Barbro"],
            "12-05": ["Sven", "Svenja"],
            "12-06": ["Nikolaus", "Niklas"],
            "12-07": ["Angela", "Angelika"],
            "12-08": ["Virginia", "Vera"],
            "12-09": ["Anna", "Annie"],
            "12-10": ["Malin", "Malena"],
            "12-11": ["Daniel", "Daniela"],
            "12-12": ["Alexander", "Alexis"],
            "12-13": ["Lucia", "Luciadagen"],
            "12-14": ["Sten", "Steen"],
            "12-15": ["Gottfrid", "Gotthard"],
            "12-16": ["Assar", "Astor"],
            "12-17": ["Stig", "Staffan"],
            "12-18": ["Abraham", "Efraim"],
            "12-19": ["Isak", "Rebecka"],
            "12-20": ["Israel", "Moses"],
            "12-21": ["Tomas", "Tom"],
            "12-22": ["Natanael", "Jonatan"],
            "12-23": ["Adam", "Eva"],
            "12-24": ["Julafton"],
            "12-25": ["Juldagen"],
            "12-26": ["Stefan", "Staffan"],
            "12-27": ["Johannes", "Johan"],
            "12-28": ["V√§rnl√∂sa barns dag"],
            "12-29": ["Natalia", "Natalie"],
            "12-30": ["Abel", "Set"],
            "12-31": ["Sylvester", "Ny√•rsafton"]
        };
        
        // Swedish holidays (fixed dates)
        const holidays = {
            "01-01": "Ny√•rsdagen",
            "01-06": "Trettondedag jul",
            "05-01": "F√∂rsta maj",
            "06-06": "Nationaldagen",
            "12-24": "Julafton",
            "12-25": "Juldagen",
            "12-26": "Annandag jul",
            "12-31": "Ny√•rsafton"
        };
        
        // Temadagar & m√§rkesdagar (fixed dates)
        const themeDays = {
            // Januari
            "01-04": { name: "Spaghettidagen", icon: "üçù", category: "mat" },
            "01-17": { name: "Munkkaffets dag", icon: "‚òï", category: "mat" },
            "01-21": { name: "Kramens dag", icon: "ü§ó", category: "international" },
            
            // Februari
            "02-05": { name: "Nutellans dag", icon: "üç´", category: "mat" },
            "02-14": { name: "Alla hj√§rtans dag", icon: "‚ù§Ô∏è", category: "international" },
            
            // Mars
            "03-08": { name: "Internationella kvinnodagen", icon: "‚ôÄÔ∏è", category: "fn" },
            "03-14": { name: "Pi-dagen", icon: "ü•ß", category: "n√∂rd" },
            "03-20": { name: "Internationella lyckodagen", icon: "üòä", category: "fn" },
            "03-25": { name: "V√•ffeldagen", icon: "üßá", category: "mat" },
            
            // April
            "04-07": { name: "V√§rldsh√§lsodagen", icon: "üè•", category: "fn" },
            "04-22": { name: "Internationella Moder Jord-dagen", icon: "üåç", category: "fn" },
            "04-23": { name: "V√§rldsbokdagen", icon: "üìö", category: "fn" },
            
            // Maj
            "05-04": { name: "Star Wars-dagen", icon: "‚öîÔ∏è", category: "n√∂rd" },
            "05-17": { name: "Norges nationaldag", icon: "üá≥üá¥", category: "nordic" },
            "05-25": { name: "Handduks¬≠dagen", icon: "üõÅ", category: "n√∂rd" },
            
            // Juni
            "06-05": { name: "V√§rldsmilj√∂dagen", icon: "üå±", category: "fn" },
            "06-08": { name: "V√§rldshavsdagen", icon: "üåä", category: "fn" },
            "06-21": { name: "Sommarsolst√•ndet", icon: "‚òÄÔ∏è", category: "swedish" },
            
            // Juli
            "07-17": { name: "V√§rldens emoji-dag", icon: "üòÄ", category: "international" },
            
            // Augusti
            "08-08": { name: "Internationella kattdagen", icon: "üê±", category: "international" },
            "08-09": { name: "Sk√§rg√•rdens dag", icon: "üèùÔ∏è", category: "swedish" },
            
            // September
            "09-13": { name: "Programmerarens dag", icon: "üíª", category: "n√∂rd" },
            "09-19": { name: "Pratar som en pirat-dagen", icon: "üè¥‚Äç‚ò†Ô∏è", category: "n√∂rd" },
            "09-21": { name: "Internationella fredsdagen", icon: "‚òÆÔ∏è", category: "fn" },
            "09-29": { name: "V√§rldshj√§rtdagen", icon: "‚ù§Ô∏è", category: "fn" },
            
            // Oktober
            "10-01": { name: "Internationella kaffedagen", icon: "‚òï", category: "international" },
            "10-04": { name: "Kanelbullens dag", icon: "ü•ê", category: "mat" },
            "10-05": { name: "V√§rldsl√§rardagen", icon: "üë©‚Äçüè´", category: "fn" },
            "10-10": { name: "V√§rldsdagen f√∂r psykisk h√§lsa", icon: "üß†", category: "fn" },
            "10-16": { name: "V√§rldsbr√∂dsdagen", icon: "üçû", category: "fn" },
            "10-24": { name: "FN-dagen", icon: "üá∫üá≥", category: "fn" },
            "10-31": { name: "Halloween", icon: "üéÉ", category: "international" },
            
            // November
            "11-07": { name: "Kladdkakans dag", icon: "üç´", category: "mat" },
            "11-09": { name: "Lussekattens dag", icon: "üê±", category: "mat" },
            "11-11": { name: "Chokladens dag", icon: "üç´", category: "mat" },
            "11-13": { name: "V√§rldsv√§nlighetsdagen", icon: "üíõ", category: "international" },
            
            // December
            "12-05": { name: "Internationella volont√§rdagen", icon: "ü§ù", category: "fn" },
            "12-10": { name: "Nobeldagen", icon: "üèÖ", category: "swedish" },
            "12-21": { name: "Vintersolst√•ndet", icon: "‚ùÑÔ∏è", category: "swedish" }
        };
        
        // R√∂rliga temadagar (ber√§knas)
        function getMoveableThemeDays(year) {
            const days = {};
            const easter = getEasterSunday(year);
            
            const addDays = (date, n) => {
                const result = new Date(date);
                result.setDate(result.getDate() + n);
                return result;
            };
            
            const toKey = (date) => formatDateKey(date.getMonth(), date.getDate());
            
            // Fettisdagen - 47 dagar f√∂re p√•sk
            const fettisdag = addDays(easter, -47);
            days[toKey(fettisdag)] = { name: "Fettisdagen", icon: "ü•Æ", category: "mat" };
            
            // Mors dag - sista s√∂ndagen i maj
            const lastMay = new Date(year, 4, 31);
            const morsdagOffset = lastMay.getDay();
            const morsdag = new Date(year, 4, 31 - morsdagOffset);
            days[toKey(morsdag)] = { name: "Mors dag", icon: "üíê", category: "swedish" };
            
            // Fars dag - andra s√∂ndagen i november
            const nov1 = new Date(year, 10, 1);
            const firstSundayNov = (7 - nov1.getDay()) % 7;
            const farsdag = new Date(year, 10, 1 + firstSundayNov + 7);
            days[toKey(farsdag)] = { name: "Fars dag", icon: "üëî", category: "swedish" };
            
            // Kanelbullens dag redan i fixed (4 okt), men semlans dag = fettisdagen
            days[toKey(fettisdag)].name = "Fettisdagen / Semlans dag";
            
            return days;
        }
        
        // H√§mta temadag f√∂r ett datum
        function getThemeDay(year, month, day) {
            const key = formatDateKey(month, day);
            
            // Kolla fasta temadagar
            if (themeDays[key]) {
                return themeDays[key];
            }
            
            // Kolla r√∂rliga temadagar
            const moveable = getMoveableThemeDays(year);
            if (moveable[key]) {
                return moveable[key];
            }
            
            return null;
        }
        
        // Calculate Easter Sunday (Gauss algorithm)
        function getEasterSunday(year) {
            const a = year % 19;
            const b = Math.floor(year / 100);
            const c = year % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31) - 1;
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(year, month, day);
        }
        
        // Get all moveable holidays for a year
        function getMoveableHolidays(year) {
            const easter = getEasterSunday(year);
            const holidays = {};
            
            // Helper to add days to a date
            const addDays = (date, days) => {
                const result = new Date(date);
                result.setDate(result.getDate() + days);
                return result;
            };
            
            // Helper to format date key
            const toKey = (date) => formatDateKey(date.getMonth(), date.getDate());
            
            // Sk√§rtorsdag (Maundy Thursday) - 3 days before Easter
            holidays[toKey(addDays(easter, -3))] = "Sk√§rtorsdagen";
            
            // L√•ngfredag (Good Friday) - 2 days before Easter
            holidays[toKey(addDays(easter, -2))] = "L√•ngfredagen";
            
            // P√•skafton (Easter Eve) - 1 day before Easter
            holidays[toKey(addDays(easter, -1))] = "P√•skafton";
            
            // P√•skdagen (Easter Sunday)
            holidays[toKey(easter)] = "P√•skdagen";
            
            // Annandag p√•sk (Easter Monday) - 1 day after Easter
            holidays[toKey(addDays(easter, 1))] = "Annandag p√•sk";
            
            // Kristi himmelsf√§rdsdag (Ascension Day) - 39 days after Easter
            holidays[toKey(addDays(easter, 39))] = "Kristi himmelsf√§rd";
            
            // Pingstafton (Whitsun Eve) - 48 days after Easter
            holidays[toKey(addDays(easter, 48))] = "Pingstafton";
            
            // Pingstdagen (Whit Sunday) - 49 days after Easter
            holidays[toKey(addDays(easter, 49))] = "Pingstdagen";
            
            // Midsommarafton (Midsummer Eve) - Friday between June 19-25
            const midsummerEve = getMidsummerEve(year);
            holidays[toKey(midsummerEve)] = "Midsommarafton";
            
            // Midsommardagen (Midsummer Day) - Saturday between June 20-26
            holidays[toKey(addDays(midsummerEve, 1))] = "Midsommardagen";
            
            // Alla helgons dag (All Saints' Day) - Saturday between Oct 31 - Nov 6
            const allSaints = getAllSaintsDay(year);
            holidays[toKey(allSaints)] = "Alla helgons dag";
            
            return holidays;
        }
        
        // Get Midsummer Eve (Friday between June 19-25)
        function getMidsummerEve(year) {
            const june19 = new Date(year, 5, 19);
            const dayOfWeek = june19.getDay();
            // Find next Friday (day 5)
            const daysUntilFriday = (5 - dayOfWeek + 7) % 7;
            return new Date(year, 5, 19 + daysUntilFriday);
        }
        
        // Get All Saints' Day (Saturday between Oct 31 - Nov 6)
        function getAllSaintsDay(year) {
            const oct31 = new Date(year, 9, 31);
            const dayOfWeek = oct31.getDay();
            // Find next Saturday (day 6)
            const daysUntilSaturday = (6 - dayOfWeek + 7) % 7;
            return new Date(year, 9, 31 + daysUntilSaturday);
        }
        
        // Check if a date is a holiday (fixed or moveable)
        function getHoliday(year, month, day) {
            const key = formatDateKey(month, day);
            
            // Check fixed holidays
            if (holidays[key]) {
                return holidays[key];
            }
            
            // Check moveable holidays
            const moveableHolidays = getMoveableHolidays(year);
            if (moveableHolidays[key]) {
                return moveableHolidays[key];
            }
            
            return null;
        }
        
        const dayNames = ['S√∂ndag', 'M√•ndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'L√∂rdag'];
        const dayNamesShort = ['S√∂', 'M√•', 'Ti', 'On', 'To', 'Fr', 'L√∂'];
        const monthNames = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                           'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
        
        // Utility functions
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }
        
        function getWeeksInYear(year) {
            const d = new Date(year, 11, 31);
            const week = getWeekNumber(d);
            return week === 1 ? 52 : week;
        }
        
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }
        
        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }
        
        function formatDateKey(month, day) {
            return `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }
        
        function getNameday(date) {
            const key = formatDateKey(date.getMonth(), date.getDate());
            return namedays[key] || [];
        }
        
        // Update clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('sv-SE');
        }
        
        // Update dashboard
        function updateDashboard() {
            const now = new Date();
            const weekNum = getWeekNumber(now);
            const weeksInYear = getWeeksInYear(now.getFullYear());
            const dayOfYear = getDayOfYear(now);
            const daysInYear = isLeapYear(now.getFullYear()) ? 366 : 365;
            const daysLeft = daysInYear - dayOfYear;
            const progress = ((dayOfYear / daysInYear) * 100).toFixed(1);
            
            // Week
            document.getElementById('week-number').textContent = weekNum;
            document.getElementById('week-text').textContent = `av ${weeksInYear}`;
            
            // Date
            document.getElementById('date-main').textContent = 
                `${dayNames[now.getDay()]} ${now.getDate()} ${monthNames[now.getMonth()].toLowerCase()}`;
            document.getElementById('date-sub').textContent = now.getFullYear();
            
            // Nameday
            const todayNames = getNameday(now);
            document.getElementById('nameday').textContent = todayNames.join(', ') || '‚Äî';
            
            // Tomorrow's nameday
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowNames = getNameday(tomorrow);
            document.getElementById('nameday-tomorrow').textContent = 
                `Imorgon: ${tomorrowNames.join(', ') || '‚Äî'}`;
            
            // Year stats
            document.getElementById('current-year').textContent = now.getFullYear();
            document.getElementById('day-of-year').textContent = `${dayOfYear} / ${daysInYear}`;
            document.getElementById('days-left').textContent = daysLeft;
            document.getElementById('year-progress').textContent = `${progress}%`;
            
            // Theme day
            const themeDay = getThemeDay(now.getFullYear(), now.getMonth(), now.getDate());
            const themeDayWidget = document.getElementById('themeday-widget');
            if (themeDay) {
                themeDayWidget.style.display = 'block';
                document.getElementById('themeday-icon').textContent = themeDay.icon;
                document.getElementById('themeday-name').textContent = themeDay.name;
            } else {
                themeDayWidget.style.display = 'none';
            }
        }
        
        // Theme handling
        function loadTheme() {
            const saved = localStorage.getItem('dagskoll_theme');
            return saved || 'dark';
        }
        
        function saveTheme(theme) {
            localStorage.setItem('dagskoll_theme', theme);
        }
        
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const toggle = document.getElementById('theme-toggle');
            toggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            toggle.title = theme === 'dark' ? 'Byt till ljust tema' : 'Byt till m√∂rkt tema';
        }
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = current === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            saveTheme(newTheme);
        }
        
        // Initialize theme immediately to prevent flash
        applyTheme(loadTheme());
        
        // Theme toggle click handler
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        
        // Swedish cities with coordinates
        const CITIES = {
            stockholm: { name: 'Stockholm', lat: 59.33, lon: 18.07 },
            goteborg: { name: 'G√∂teborg', lat: 57.71, lon: 11.97 },
            malmo: { name: 'Malm√∂', lat: 55.60, lon: 13.00 },
            uppsala: { name: 'Uppsala', lat: 59.86, lon: 17.64 },
            linkoping: { name: 'Link√∂ping', lat: 58.41, lon: 15.62 },
            orebro: { name: '√ñrebro', lat: 59.27, lon: 15.21 },
            vasteras: { name: 'V√§ster√•s', lat: 59.61, lon: 16.55 },
            norrkoping: { name: 'Norrk√∂ping', lat: 58.59, lon: 16.18 },
            jonkoping: { name: 'J√∂nk√∂ping', lat: 57.78, lon: 14.16 },
            umea: { name: 'Ume√•', lat: 63.83, lon: 20.26 },
            lulea: { name: 'Lule√•', lat: 65.58, lon: 22.15 },
            sundsvall: { name: 'Sundsvall', lat: 62.39, lon: 17.31 },
            karlstad: { name: 'Karlstad', lat: 59.38, lon: 13.50 },
            gavle: { name: 'G√§vle', lat: 60.67, lon: 17.15 },
            vaxjo: { name: 'V√§xj√∂', lat: 56.88, lon: 14.81 }
        };
        
        // Current location (default Stockholm, or from localStorage)
        let currentLocation = loadLocation();
        
        function loadLocation() {
            const saved = localStorage.getItem('dagskoll_location');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return { ...CITIES.stockholm, id: 'stockholm' };
                }
            }
            return { ...CITIES.stockholm, id: 'stockholm' };
        }
        
        function saveLocation(location) {
            localStorage.setItem('dagskoll_location', JSON.stringify(location));
        }
        
        // Fetch sun times from Open-Meteo
        async function fetchSunTimes() {
            try {
                const { lat, lon } = currentLocation;
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=Europe/Stockholm&forecast_days=1`
                );
                const data = await response.json();
                
                if (data.daily) {
                    const sunrise = new Date(data.daily.sunrise[0]);
                    const sunset = new Date(data.daily.sunset[0]);
                    
                    document.getElementById('sunrise').textContent = 
                        sunrise.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('sunset').textContent = 
                        sunset.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit' });
                    
                    // Calculate daylight
                    const daylightMs = sunset - sunrise;
                    const daylightHours = Math.floor(daylightMs / (1000 * 60 * 60));
                    const daylightMinutes = Math.floor((daylightMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('daylight-text').textContent = 
                        `${daylightHours}h ${daylightMinutes}m dagsljus`;
                    
                    // Daylight bar (percentage of 24h)
                    const daylightPercent = (daylightMs / (24 * 60 * 60 * 1000)) * 100;
                    document.getElementById('daylight-bar').style.width = `${daylightPercent}%`;
                }
            } catch (error) {
                console.error('Could not fetch sun times:', error);
            }
        }
        
        // SMHI weather symbol to description and icon
        function getWeatherInfo(code) {
            const weatherCodes = {
                1: { desc: 'Klart', icon: '‚òÄÔ∏è' },
                2: { desc: 'L√§tt molnighet', icon: 'üå§Ô∏è' },
                3: { desc: 'Halvklart', icon: '‚õÖ' },
                4: { desc: 'Molnigt', icon: 'üå•Ô∏è' },
                5: { desc: 'Mulet', icon: '‚òÅÔ∏è' },
                6: { desc: 'Mulet', icon: '‚òÅÔ∏è' },
                7: { desc: 'Dimma', icon: 'üå´Ô∏è' },
                8: { desc: 'L√§tta regnskurar', icon: 'üå¶Ô∏è' },
                9: { desc: 'Regnskurar', icon: 'üå¶Ô∏è' },
                10: { desc: 'Kraftiga regnskurar', icon: 'üå¶Ô∏è' },
                11: { desc: '√Öskv√§der', icon: '‚õàÔ∏è' },
                12: { desc: 'L√§tta byar av regn och sn√∂', icon: 'üå®Ô∏è' },
                13: { desc: 'Byar av regn och sn√∂', icon: 'üå®Ô∏è' },
                14: { desc: 'Kraftiga byar av regn och sn√∂', icon: 'üå®Ô∏è' },
                15: { desc: 'L√§tta sn√∂byar', icon: 'üå®Ô∏è' },
                16: { desc: 'Sn√∂byar', icon: 'üå®Ô∏è' },
                17: { desc: 'Kraftiga sn√∂byar', icon: 'üå®Ô∏è' },
                18: { desc: 'L√§tt regn', icon: 'üåßÔ∏è' },
                19: { desc: 'Regn', icon: 'üåßÔ∏è' },
                20: { desc: 'Kraftigt regn', icon: 'üåßÔ∏è' },
                21: { desc: '√Öska', icon: '‚õàÔ∏è' },
                22: { desc: 'L√§tt sn√∂blandat regn', icon: 'üå®Ô∏è' },
                23: { desc: 'Sn√∂blandat regn', icon: 'üå®Ô∏è' },
                24: { desc: 'Kraftigt sn√∂blandat regn', icon: 'üå®Ô∏è' },
                25: { desc: 'L√§tt sn√∂fall', icon: 'üå®Ô∏è' },
                26: { desc: 'Sn√∂fall', icon: '‚ùÑÔ∏è' },
                27: { desc: 'Kraftigt sn√∂fall', icon: '‚ùÑÔ∏è' }
            };
            return weatherCodes[code] || { desc: 'Ok√§nt', icon: 'üå°Ô∏è' };
        }
        
        // Fetch 3-day forecast from SMHI
        async function fetchWeather() {
            const forecastGrid = document.getElementById('forecast-grid');
            
            try {
                const { lat, lon } = currentLocation;
                // SMHI kr√§ver max 6 decimaler
                const latRound = lat.toFixed(6);
                const lonRound = lon.toFixed(6);
                
                const response = await fetch(
                    `https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${lonRound}/lat/${latRound}/data.json`
                );
                const data = await response.json();
                
                if (data.timeSeries) {
                    const dayNames = ['S√∂ndag', 'M√•ndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'L√∂rdag'];
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    // Gruppera data per dag (n√§rmast kl 12 f√∂r representativt v√§der)
                    const dailyData = {};
                    
                    data.timeSeries.forEach(entry => {
                        const date = new Date(entry.validTime);
                        const dateKey = date.toISOString().split('T')[0];
                        const hour = date.getHours();
                        
                        // H√§mta parametrar
                        const params = {};
                        entry.parameters.forEach(p => {
                            params[p.name] = p.values[0];
                        });
                        
                        if (!dailyData[dateKey]) {
                            dailyData[dateKey] = {
                                date: date,
                                temps: [],
                                winds: [],
                                precips: [],
                                symbol: null,
                                symbolHour: 24
                            };
                        }
                        
                        // Samla temperatur och vind
                        if (params.t !== undefined) dailyData[dateKey].temps.push(params.t);
                        if (params.ws !== undefined) dailyData[dateKey].winds.push(params.ws);
                        if (params.pmean !== undefined) dailyData[dateKey].precips.push(params.pmean);
                        
                        // Ta v√§dersymbol n√§rmast kl 12
                        if (params.Wsymb2 !== undefined) {
                            const distTo12 = Math.abs(hour - 12);
                            if (distTo12 < dailyData[dateKey].symbolHour) {
                                dailyData[dateKey].symbol = params.Wsymb2;
                                dailyData[dateKey].symbolHour = distTo12;
                            }
                        }
                    });
                    
                    // Konvertera till array och ta 3 dagar
                    const days = Object.values(dailyData).slice(0, 3).map((day, i) => {
                        let dayName;
                        if (i === 0) {
                            dayName = 'Idag';
                        } else if (i === 1) {
                            dayName = 'Imorgon';
                        } else {
                            dayName = dayNames[day.date.getDay()];
                        }
                        
                        const weatherInfo = getWeatherInfo(day.symbol);
                        const tempMax = Math.round(Math.max(...day.temps));
                        const tempMin = Math.round(Math.min(...day.temps));
                        const windMax = Math.round(Math.max(...day.winds));
                        const precipSum = day.precips.reduce((a, b) => a + b, 0).toFixed(1);
                        
                        return {
                            dayName,
                            icon: weatherInfo.icon,
                            desc: weatherInfo.desc,
                            tempMax,
                            tempMin,
                            wind: windMax,
                            precip: precipSum
                        };
                    });
                    
                    forecastGrid.innerHTML = days.map(day => `
                        <div class="forecast-day" title="${day.desc}">
                            <div class="forecast-day-name">${day.dayName}</div>
                            <div class="forecast-icon">${day.icon}</div>
                            <div class="forecast-temps">
                                <span class="forecast-temp-high">${day.tempMax}¬∞</span>
                                <span class="forecast-temp-low">${day.tempMin}¬∞</span>
                            </div>
                            <div class="forecast-details">
                                <span class="forecast-detail"><span class="forecast-detail-icon">üí®</span>${day.wind}</span>
                                <span class="forecast-detail"><span class="forecast-detail-icon">üíß</span>${day.precip}mm</span>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Could not fetch weather:', error);
                forecastGrid.innerHTML = `
                    <div class="forecast-day">
                        <div class="forecast-day-name">Fel</div>
                        <div class="forecast-icon">‚ö†Ô∏è</div>
                        <div class="forecast-temps">
                            <span class="forecast-temp-high">--</span>
                        </div>
                    </div>
                `;
            }
        }
        
        // City selector change handler
        document.getElementById('city-select').addEventListener('change', (e) => {
            const cityId = e.target.value;
            const city = CITIES[cityId];
            if (city) {
                currentLocation = { ...city, id: cityId };
                saveLocation(currentLocation);
                fetchWeather();
                fetchSunTimes();
            }
        });
        
        // Geolocation button handler
        document.getElementById('geolocation-btn').addEventListener('click', () => {
            const btn = document.getElementById('geolocation-btn');
            const select = document.getElementById('city-select');
            
            if (!navigator.geolocation) {
                alert('Din webbl√§sare st√∂djer inte geolocation');
                return;
            }
            
            btn.classList.add('loading');
            btn.textContent = '‚è≥';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    currentLocation = {
                        name: 'Min position',
                        lat: latitude,
                        lon: longitude,
                        id: 'geolocation'
                    };
                    saveLocation(currentLocation);
                    
                    // Add "Min position" option if not exists
                    let geoOption = select.querySelector('option[value="geolocation"]');
                    if (!geoOption) {
                        geoOption = document.createElement('option');
                        geoOption.value = 'geolocation';
                        geoOption.textContent = 'üìç Min position';
                        select.insertBefore(geoOption, select.firstChild);
                    }
                    select.value = 'geolocation';
                    
                    btn.classList.remove('loading');
                    btn.textContent = 'üìç';
                    
                    fetchWeather();
                    fetchSunTimes();
                },
                (error) => {
                    btn.classList.remove('loading');
                    btn.textContent = 'üìç';
                    
                    let message = 'Kunde inte h√§mta position';
                    if (error.code === error.PERMISSION_DENIED) {
                        message = 'Du nekade √•tkomst till din position';
                    }
                    alert(message);
                },
                { enableHighAccuracy: false, timeout: 10000 }
            );
        });
        
        // Initialize city selector from saved location
        function initLocationSelector() {
            const select = document.getElementById('city-select');
            
            if (currentLocation.id === 'geolocation') {
                const geoOption = document.createElement('option');
                geoOption.value = 'geolocation';
                geoOption.textContent = 'üìç Min position';
                select.insertBefore(geoOption, select.firstChild);
                select.value = 'geolocation';
            } else if (currentLocation.id && CITIES[currentLocation.id]) {
                select.value = currentLocation.id;
            }
        }
        
        // Generate year calendar
        let displayYear = new Date().getFullYear();
        
        function generateYearCalendar(year) {
            const container = document.getElementById('year-calendar');
            const today = new Date();
            container.innerHTML = '';
            
            document.getElementById('calendar-year').textContent = year;
            
            for (let month = 0; month < 12; month++) {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                
                if (year === today.getFullYear() && month === today.getMonth()) {
                    monthCard.classList.add('current');
                }
                
                // Month name
                const monthName = document.createElement('div');
                monthName.className = 'month-name';
                monthName.textContent = monthNames[month];
                monthCard.appendChild(monthName);
                
                // Weekday header (with empty space for week numbers)
                const weekdayHeader = document.createElement('div');
                weekdayHeader.className = 'weekday-header';
                weekdayHeader.style.cssText = 'display: grid; grid-template-columns: 16px repeat(7, 1fr); gap: 2px; margin-bottom: 4px;';
                
                // Empty cell for week number column
                const emptyHeader = document.createElement('span');
                emptyHeader.textContent = '';
                weekdayHeader.appendChild(emptyHeader);
                
                // Weekday names
                const weekdays = ['M√•', 'Ti', 'On', 'To', 'Fr', 'L√∂', 'S√∂'];
                weekdays.forEach(day => {
                    const span = document.createElement('span');
                    span.textContent = day;
                    weekdayHeader.appendChild(span);
                });
                monthCard.appendChild(weekdayHeader);
                
                // Build weeks array for the month
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                // Adjust for Monday start (0 = Monday, 6 = Sunday)
                let startDay = firstDay.getDay() - 1;
                if (startDay < 0) startDay = 6;
                
                // Create weeks container
                const weeksContainer = document.createElement('div');
                weeksContainer.style.cssText = 'display: flex; flex-direction: column; gap: 2px;';
                
                let currentDay = 1;
                let weekCount = 0;
                
                while (currentDay <= daysInMonth) {
                    const weekRow = document.createElement('div');
                    weekRow.style.cssText = 'display: grid; grid-template-columns: 16px repeat(7, 1fr); gap: 2px;';
                    
                    // Get week number for this row
                    let weekDate;
                    if (weekCount === 0 && startDay > 0) {
                        // First week might start with empty cells, use first actual day
                        weekDate = new Date(year, month, 1);
                    } else {
                        weekDate = new Date(year, month, currentDay);
                    }
                    const weekNum = getWeekNumber(weekDate);
                    
                    // Week number cell
                    const weekNumCell = document.createElement('div');
                    weekNumCell.className = 'week-num';
                    weekNumCell.textContent = weekNum;
                    weekNumCell.title = `Vecka ${weekNum}`;
                    weekRow.appendChild(weekNumCell);
                    
                    // Days in this week
                    for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
                        const dayCell = document.createElement('div');
                        dayCell.className = 'day-cell';
                        
                        // First week padding
                        if (weekCount === 0 && dayOfWeek < startDay) {
                            dayCell.classList.add('empty');
                        } else if (currentDay <= daysInMonth) {
                            dayCell.textContent = currentDay;
                            
                            const currentDate = new Date(year, month, currentDay);
                            const dayOfWeekNum = currentDate.getDay();
                            
                            // Check if today
                            if (year === today.getFullYear() && 
                                month === today.getMonth() && 
                                currentDay === today.getDate()) {
                                dayCell.classList.add('today');
                            }
                            
                            // Check if holiday (fixed or moveable)
                            const holiday = getHoliday(year, month, currentDay);
                            if (holiday) {
                                dayCell.classList.add('holiday');
                                dayCell.title = holiday;
                            }
                            
                            // Check if themeday
                            const themeDay = getThemeDay(year, month, currentDay);
                            if (themeDay) {
                                dayCell.classList.add('themeday');
                                if (dayCell.title) {
                                    dayCell.title += ' | ' + themeDay.icon + ' ' + themeDay.name;
                                } else {
                                    dayCell.title = themeDay.icon + ' ' + themeDay.name;
                                }
                            }
                            
                            // Sunday styling
                            if (dayOfWeekNum === 0) {
                                dayCell.classList.add('sunday');
                            }
                            
                            // Saturday styling
                            if (dayOfWeekNum === 6) {
                                dayCell.classList.add('weekend');
                            }
                            
                            currentDay++;
                        } else {
                            dayCell.classList.add('empty');
                        }
                        
                        weekRow.appendChild(dayCell);
                    }
                    
                    weeksContainer.appendChild(weekRow);
                    weekCount++;
                }
                
                monthCard.appendChild(weeksContainer);
                container.appendChild(monthCard);
            }

            // Scrolla till aktuell m√•nad p√• mobil
            scrollToCurrentMonth();
        }

        function scrollToCurrentMonth() {
            if (window.innerWidth > 500) return;
            const container = document.getElementById('year-calendar');
            const currentMonth = container.querySelector('.month-card.current');
            if (currentMonth) {
                setTimeout(() => {
                    currentMonth.scrollIntoView({ behavior: 'auto', inline: 'center', block: 'nearest' });
                }, 100);
            }
        }

        // Calendar navigation
        document.getElementById('prev-year').addEventListener('click', () => {
            displayYear--;
            generateYearCalendar(displayYear);
            updateYearButtons();
        });
        
        document.getElementById('next-year').addEventListener('click', () => {
            displayYear++;
            generateYearCalendar(displayYear);
            updateYearButtons();
        });
        
        document.getElementById('current-year-btn').addEventListener('click', () => {
            displayYear = new Date().getFullYear();
            generateYearCalendar(displayYear);
            updateYearButtons();
        });
        
        function updateYearButtons() {
            const currentYear = new Date().getFullYear();
            const btn = document.getElementById('current-year-btn');
            btn.classList.toggle('active', displayYear === currentYear);
        }
        
        // Initialize
        function init() {
            updateClock();
            updateDashboard();
            initLocationSelector();
            fetchSunTimes();
            fetchWeather();
            generateYearCalendar(displayYear);
            
            // Update clock every second
            setInterval(updateClock, 1000);
            
            // Update dashboard every minute
            setInterval(updateDashboard, 60000);
            
            // Refresh weather every 15 minutes
            setInterval(fetchWeather, 15 * 60 * 1000);
            
            // Refresh sun times at midnight
            const now = new Date();
            const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0);
            const msUntilMidnight = midnight - now;
            setTimeout(() => {
                fetchSunTimes();
                setInterval(fetchSunTimes, 24 * 60 * 60 * 1000);
            }, msUntilMidnight);
        }
        
        init();
        
        // RSS Feed URLs
        const RSS_FEEDS = {
            svt: {
                url: 'https://www.svt.se/nyheter/rss.xml',
                name: 'SVT',
                color: '#e02e3d'
            },
            sr: {
                url: 'https://api.sr.se/api/rss/program/83',
                name: 'SR Ekot',
                color: '#00a0dc'
            },
            feber: {
                url: 'https://feber.se/rss',
                name: 'Feber',
                color: '#ff6600'
            }
        };
        
        // Store all news items
        let allNewsItems = [];
        let currentFilter = 'all';
        
        // Fetch RSS via proxy (try multiple proxies)
        async function fetchRSS(feedKey) {
            const feed = RSS_FEEDS[feedKey];
            
            // Try rss2json first
            const proxies = [
                `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`,
                `https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`
            ];
            
            // Try rss2json
            try {
                const response = await fetch(proxies[0]);
                const data = await response.json();
                
                if (data.status === 'ok' && data.items && data.items.length > 0) {
                    return data.items.slice(0, 5).map(item => ({
                        title: item.title,
                        link: item.link,
                        pubDate: new Date(item.pubDate),
                        source: feedKey,
                        sourceName: feed.name,
                        sourceColor: feed.color
                    }));
                }
            } catch (error) {
                console.log(`rss2json failed for ${feedKey}, trying allorigins...`);
            }
            
            // Fallback: try allorigins and parse XML
            try {
                const response = await fetch(proxies[1]);
                const data = await response.json();
                
                if (data.contents) {
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(data.contents, 'text/xml');
                    const items = xml.querySelectorAll('item');
                    
                    if (items.length > 0) {
                        return Array.from(items).slice(0, 5).map(item => ({
                            title: item.querySelector('title')?.textContent || 'Ingen titel',
                            link: item.querySelector('link')?.textContent || '#',
                            pubDate: new Date(item.querySelector('pubDate')?.textContent || Date.now()),
                            source: feedKey,
                            sourceName: feed.name,
                            sourceColor: feed.color
                        }));
                    }
                }
            } catch (error) {
                console.error(`All proxies failed for ${feedKey}:`, error);
            }
            
            return [];
        }
        
        // Fetch all feeds
        async function fetchAllNews() {
            const newsGrid = document.getElementById('news-grid');
            newsGrid.innerHTML = `
                <div class="news-card">
                    <div class="news-source">‚è≥</div>
                    <div class="news-title">H√§mtar nyheter...</div>
                    <div class="news-time"></div>
                </div>
            `;
            
            try {
                const results = await Promise.all([
                    fetchRSS('svt'),
                    fetchRSS('sr'),
                    fetchRSS('feber')
                ]);
                
                allNewsItems = results.flat().sort((a, b) => b.pubDate - a.pubDate);
                renderNews();
            } catch (error) {
                console.error('Error fetching news:', error);
                newsGrid.innerHTML = `
                    <div class="news-card">
                        <div class="news-source">Fel</div>
                        <div class="news-title">Kunde inte h√§mta nyheter</div>
                        <div class="news-time">F√∂rs√∂k igen senare</div>
                    </div>
                `;
            }
        }
        
        // Render news based on current filter
        function renderNews() {
            const newsGrid = document.getElementById('news-grid');
            let items = currentFilter === 'all' 
                ? allNewsItems.slice(0, 9)
                : allNewsItems.filter(item => item.source === currentFilter).slice(0, 6);
            
            if (items.length === 0) {
                newsGrid.innerHTML = `
                    <div class="news-card">
                        <div class="news-source">Info</div>
                        <div class="news-title">Inga nyheter att visa</div>
                        <div class="news-time"></div>
                    </div>
                `;
                return;
            }
            
            newsGrid.innerHTML = items.map(item => `
                <div class="news-card" data-source="${item.source}">
                    <a href="${item.link}" target="_blank" rel="noopener">
                        <div class="news-source" style="color: ${item.sourceColor}">${item.sourceName}</div>
                        <div class="news-title">${escapeHtml(item.title)}</div>
                        <div class="news-time">${formatTimeAgo(item.pubDate)}</div>
                    </a>
                </div>
            `).join('');
        }
        
        // Format time ago
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just nu';
            if (diffMins < 60) return `${diffMins} min sedan`;
            if (diffHours < 24) return `${diffHours} tim sedan`;
            if (diffDays === 1) return 'Ig√•r';
            return `${diffDays} dagar sedan`;
        }
        
        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // News filter click handlers
        document.querySelectorAll('.news-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.news-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.source;
                renderNews();
            });
        });
        
        // Fetch news on load
        fetchAllNews();
        
        // Refresh news every 5 minutes
        setInterval(fetchAllNews, 5 * 60 * 1000);
        
        // ============ ON THIS DAY / HISTORY ============
        
        let historyData = {
            events: [],
            births: [],
            deaths: []
        };
        let currentHistoryType = 'events';
        
        // Fetch "On this day" from Wikipedia API
        async function fetchOnThisDay() {
            const today = new Date();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            
            const url = `https://api.wikimedia.org/feed/v1/wikipedia/en/onthisday/all/${month}/${day}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data) {
                    // Store data
                    historyData.events = (data.events || []).slice(0, 12);
                    historyData.births = (data.births || []).slice(0, 12);
                    historyData.deaths = (data.deaths || []).slice(0, 12);
                    
                    renderHistory();
                }
            } catch (error) {
                console.error('Could not fetch history:', error);
                document.getElementById('history-grid').innerHTML = `
                    <div class="history-card">
                        <div class="history-year">‚ö†Ô∏è</div>
                        <div class="history-text">Kunde inte h√§mta historiska h√§ndelser</div>
                    </div>
                `;
            }
        }
        
        // Render history based on current filter
        function renderHistory() {
            const grid = document.getElementById('history-grid');
            const items = historyData[currentHistoryType];
            
            if (!items || items.length === 0) {
                grid.innerHTML = `
                    <div class="history-card">
                        <div class="history-year">‚Äî</div>
                        <div class="history-text">Inga ${currentHistoryType === 'events' ? 'h√§ndelser' : currentHistoryType === 'births' ? 'f√∂dda' : 'd√∂da'} att visa</div>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = items.slice(0, 6).map(item => {
                const year = item.year || '?';
                const text = item.text || 'Ingen beskrivning';
                const link = item.pages && item.pages[0] ? item.pages[0].content_urls?.desktop?.page : null;
                
                const content = `
                    <div class="history-year">${year}</div>
                    <div class="history-text">${escapeHtml(text)}</div>
                `;
                
                if (link) {
                    return `<div class="history-card"><a href="${link}" target="_blank" rel="noopener">${content}</a></div>`;
                }
                return `<div class="history-card">${content}</div>`;
            }).join('');
        }
        
        // History filter click handlers
        document.querySelectorAll('.history-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.history-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentHistoryType = btn.dataset.type;
                renderHistory();
            });
        });
        
        // Fetch history on load
        fetchOnThisDay();
        
        // ============ QUOTES ============
        
        const quotes = [
            // Filosofi & visdom
            { text: "Jag t√§nker, allts√• finns jag.", author: "Ren√© Descartes", meta: "filosof" },
            { text: "Det enda jag vet √§r att jag ingenting vet.", author: "Sokrates", meta: "filosof" },
            { text: "Livet √§r vad som h√§nder medan du √§r upptagen med att g√∂ra andra planer.", author: "John Lennon", meta: "musiker" },
            { text: "Var sj√§lv den f√∂r√§ndring du vill se i v√§rlden.", author: "Mahatma Gandhi", meta: "aktivist" },
            { text: "Den som har ett varf√∂r att leva f√∂r kan uth√§rda n√§stan vilket hur som helst.", author: "Friedrich Nietzsche", meta: "filosof" },
            { text: "Fantasi √§r viktigare √§n kunskap.", author: "Albert Einstein", meta: "fysiker" },
            { text: "Att vara eller inte vara, det √§r fr√•gan.", author: "William Shakespeare", meta: "dramatiker" },
            { text: "Frihet √§r inte v√§rt att ha om den inte innefattar friheten att g√∂ra misstag.", author: "Mahatma Gandhi", meta: "aktivist" },
            
            // Framg√•ng & motivation
            { text: "Den enda om√∂jliga resan √§r den du aldrig p√•b√∂rjar.", author: "Tony Robbins", meta: "f√∂rfattare" },
            { text: "Framg√•ng √§r inte slutgiltig, misslyckande √§r inte √∂desdigert: det √§r modet att forts√§tta som r√§knas.", author: "Winston Churchill", meta: "statsman" },
            { text: "Det spelar ingen roll hur l√•ngsamt du g√•r s√• l√§nge du inte stannar.", author: "Konfucius", meta: "filosof" },
            { text: "Den b√§sta tiden att plantera ett tr√§d var f√∂r tjugo √•r sedan. Den n√§st b√§sta tiden √§r nu.", author: "Kinesiskt ordspr√•k", meta: "" },
            { text: "G√∂r det du √§r r√§dd f√∂r och r√§dslan kommer s√§kert att d√∂.", author: "Ralph Waldo Emerson", meta: "filosof" },
            { text: "Framg√•ng √§r att g√• fr√•n misslyckande till misslyckande utan att f√∂rlora entusiasmen.", author: "Winston Churchill", meta: "statsman" },
            { text: "M√∂jligheter kommer inte av sig sj√§lva. Du skapar dem.", author: "Chris Grosser", meta: "entrepren√∂r" },
            { text: "Det √§r aldrig f√∂r sent att bli vad du kunde ha varit.", author: "George Eliot", meta: "f√∂rfattare" },
            
            // Kreativitet & konst
            { text: "Kreativitet kr√§ver mod.", author: "Henri Matisse", meta: "konstn√§r" },
            { text: "Varje barn √§r en konstn√§r. Problemet √§r att f√∂rbli konstn√§r n√§r man v√§xer upp.", author: "Pablo Picasso", meta: "konstn√§r" },
            { text: "Logik tar dig fr√•n A till B. Fantasi tar dig √∂verallt.", author: "Albert Einstein", meta: "fysiker" },
            { text: "Konsten tv√§ttar bort sj√§lens damm fr√•n vardagslivet.", author: "Pablo Picasso", meta: "konstn√§r" },
            { text: "Utan musik vore livet ett misstag.", author: "Friedrich Nietzsche", meta: "filosof" },
            
            // K√§rlek & relationer
            { text: "Det enda vi har att frukta √§r fruktan sj√§lv.", author: "Franklin D. Roosevelt", meta: "president" },
            { text: "I slut√§ndan √§r det inte √•ren i ditt liv som r√§knas, utan livet i dina √•r.", author: "Abraham Lincoln", meta: "president" },
            { text: "Att √§lska och bli √§lskad √§r att k√§nna solen fr√•n b√•da h√•llen.", author: "David Viscott", meta: "psykiater" },
            { text: "Det finns bara en lycka i livet: att √§lska och bli √§lskad.", author: "George Sand", meta: "f√∂rfattare" },
            
            // Vetenskap & kunskap
            { text: "Den som aldrig gjort ett misstag har aldrig provat n√•got nytt.", author: "Albert Einstein", meta: "fysiker" },
            { text: "Kunskap talar, men visdom lyssnar.", author: "Jimi Hendrix", meta: "musiker" },
            { text: "Ju mer jag l√§r mig, desto mer inser jag hur mycket jag inte vet.", author: "Albert Einstein", meta: "fysiker" },
            { text: "Utbildning √§r det m√§ktigaste vapnet du kan anv√§nda f√∂r att f√∂r√§ndra v√§rlden.", author: "Nelson Mandela", meta: "statsman" },
            
            // Livets mening
            { text: "Livet √§r verkligen enkelt, men vi insisterar p√• att g√∂ra det komplicerat.", author: "Konfucius", meta: "filosof" },
            { text: "Det √§r inte hur l√§nge du lever som spelar roll, utan hur.", author: "Seneca", meta: "filosof" },
            { text: "Lycka √§r inte n√•got f√§rdigt. Den kommer fr√•n dina egna handlingar.", author: "Dalai Lama", meta: "andlig ledare" },
            { text: "Syftet med v√•ra liv √§r att vara lyckliga.", author: "Dalai Lama", meta: "andlig ledare" },
            { text: "Livet f√∂rst√•s bakl√§nges men m√•ste levas framl√§nges.", author: "S√∏ren Kierkegaard", meta: "filosof" },
            
            // Mod & styrka
            { text: "Mod √§r inte avsaknaden av r√§dsla, utan bed√∂mningen att n√•got annat √§r viktigare.", author: "Ambrose Redmoon", meta: "f√∂rfattare" },
            { text: "Du m√•ste g√∂ra det du tror att du inte kan.", author: "Eleanor Roosevelt", meta: "diplomat" },
            { text: "Det som inte d√∂dar oss g√∂r oss starkare.", author: "Friedrich Nietzsche", meta: "filosof" },
            { text: "En hj√§lte √§r inte modigare √§n en vanlig m√§nniska, men modig fem minuter l√§ngre.", author: "Ralph Waldo Emerson", meta: "filosof" },
            
            // Enkelhet & sanning
            { text: "Enkelhet √§r den yttersta formen av sofistikering.", author: "Leonardo da Vinci", meta: "konstn√§r & uppfinnare" },
            { text: "Sanningen √§r s√§llan ren och aldrig enkel.", author: "Oscar Wilde", meta: "f√∂rfattare" },
            { text: "Var dig sj√§lv; alla andra √§r redan upptagna.", author: "Oscar Wilde", meta: "f√∂rfattare" },
            { text: "Det √§r b√§ttre att bli hatad f√∂r den man √§r √§n att bli √§lskad f√∂r den man inte √§r.", author: "Andr√© Gide", meta: "f√∂rfattare" },
            
            // Tid & handling
            { text: "Skjut inte upp till morgondagen det du kan g√∂ra idag.", author: "Benjamin Franklin", meta: "uppfinnare" },
            { text: "Tid du njuter av att sl√∂sa √§r inte sl√∂sad tid.", author: "Bertrand Russell", meta: "filosof" },
            { text: "G√•r det inte att g√∂ra snabbt, g√∂r det l√•ngsamt men g√∂r det.", author: "Japanskt ordspr√•k", meta: "" },
            { text: "Den som flyttar berg b√∂rjar med att b√§ra sm√• stenar.", author: "Konfucius", meta: "filosof" },
            
            // Dr√∂mmar & hopp
            { text: "Alla v√•ra dr√∂mmar kan g√• i uppfyllelse om vi har modet att f√∂rverkliga dem.", author: "Walt Disney", meta: "entrepren√∂r" },
            { text: "H√•ll blicken mot stj√§rnorna och f√∂tterna p√• jorden.", author: "Theodore Roosevelt", meta: "president" },
            { text: "Det finns inga hoppl√∂sa situationer, endast m√§nniskor som har f√∂rlorat hoppet.", author: "Clare Boothe Luce", meta: "f√∂rfattare" },
            { text: "En dr√∂m du dr√∂mmer ensam √§r bara en dr√∂m. En dr√∂m ni dr√∂mmer tillsammans √§r verklighet.", author: "Yoko Ono", meta: "konstn√§r" }
        ];
        
        let currentQuoteIndex = 0;
        
        // Initialize with today's quote based on day of year
        function initQuote() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
            currentQuoteIndex = dayOfYear % quotes.length;
            displayQuote();
        }
        
        function displayQuote() {
            const quote = quotes[currentQuoteIndex];
            document.getElementById('quote-text').textContent = quote.text;
            
            const authorEl = document.getElementById('quote-author');
            if (quote.meta) {
                authorEl.innerHTML = `${quote.author} <span class="quote-meta">${quote.meta}</span>`;
            } else {
                authorEl.textContent = quote.author;
            }
            
            document.getElementById('quote-counter').textContent = `${currentQuoteIndex + 1}/${quotes.length}`;
        }
        
        document.getElementById('prev-quote').addEventListener('click', () => {
            currentQuoteIndex = (currentQuoteIndex - 1 + quotes.length) % quotes.length;
            displayQuote();
        });
        
        document.getElementById('next-quote').addEventListener('click', () => {
            currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
            displayQuote();
        });
        
        document.getElementById('random-quote').addEventListener('click', () => {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * quotes.length);
            } while (newIndex === currentQuoteIndex && quotes.length > 1);
            currentQuoteIndex = newIndex;
            displayQuote();
        });
        
        // Initialize quotes
        initQuote();

        // ============ OS 2026 MILANO-CORTINA ============

        const olympicsEvents = [
            // Curling Mixed Dubbel (4-6 feb)
            { date: '2026-02-04', time: '19:05', sport: 'curling', event: 'Sverige ‚Äì Sydkorea', type: 'Mixed dubbel' },
            { date: '2026-02-05', time: '10:05', sport: 'curling', event: 'Sverige ‚Äì Tjeckien', type: 'Mixed dubbel' },
            { date: '2026-02-05', time: '19:05', sport: 'curling', event: 'Estland ‚Äì Sverige', type: 'Mixed dubbel' },
            { date: '2026-02-06', time: '10:05', sport: 'curling', event: 'Sverige ‚Äì Storbritannien', type: 'Mixed dubbel' },

            // Snowboard Big Air (5-6 feb)
            { date: '2026-02-05', time: '19:30', sport: 'snowboard', event: 'Big Air kval', type: 'Snowboard herrar' },
            { date: '2026-02-06', time: '19:30', sport: 'snowboard', event: 'Big Air final', type: 'Snowboard herrar' },

            // Hockey Damer (5-10 feb)
            { date: '2026-02-05', time: '12:10', sport: 'hockey', event: 'Sverige ‚Äì Tyskland', type: 'Damer gruppspel' },
            { date: '2026-02-07', time: '14:40', sport: 'hockey', event: 'Sverige ‚Äì Italien', type: 'Damer gruppspel' },
            { date: '2026-02-08', time: '16:40', sport: 'hockey', event: 'Frankrike ‚Äì Sverige', type: 'Damer gruppspel' },
            { date: '2026-02-10', time: '12:10', sport: 'hockey', event: 'Japan ‚Äì Sverige', type: 'Damer gruppspel' },

            // L√§ngdskidor (7-22 feb) - OBS: Fr√•n 2026 k√∂r damer & herrar samma distanser!
            { date: '2026-02-07', time: '13:00', sport: 'skiing', event: 'Skiathlon 10+10 km', type: 'L√§ngd damer' },
            { date: '2026-02-08', time: '12:30', sport: 'skiing', event: 'Skiathlon 10+10 km', type: 'L√§ngd herrar' },
            { date: '2026-02-10', time: '11:45', sport: 'skiing', event: 'Sprint final', type: 'L√§ngd' },
            { date: '2026-02-12', time: '13:00', sport: 'skiing', event: '10 km klassisk', type: 'L√§ngd damer' },
            { date: '2026-02-13', time: '12:00', sport: 'skiing', event: '10 km fri stil', type: 'L√§ngd herrar' },
            { date: '2026-02-14', time: '12:00', sport: 'skiing', event: 'Stafett 4x7,5 km', type: 'L√§ngd damer' },
            { date: '2026-02-15', time: '12:00', sport: 'skiing', event: 'Stafett 4x7,5 km', type: 'L√§ngd herrar' },
            { date: '2026-02-18', time: '11:00', sport: 'skiing', event: 'Lagsprint', type: 'L√§ngd' },
            { date: '2026-02-21', time: '12:30', sport: 'skiing', event: '50 km masstart', type: 'L√§ngd herrar' },
            { date: '2026-02-22', time: '10:00', sport: 'skiing', event: '50 km masstart', type: 'L√§ngd damer' },

            // Freeski Slopestyle (7-10 feb)
            { date: '2026-02-07', time: '10:30', sport: 'freestyle', event: 'Slopestyle kval', type: 'Freeski damer' },
            { date: '2026-02-07', time: '14:00', sport: 'freestyle', event: 'Slopestyle kval', type: 'Freeski herrar' },
            { date: '2026-02-09', time: '12:30', sport: 'freestyle', event: 'Slopestyle final', type: 'Freeski damer' },
            { date: '2026-02-10', time: '12:30', sport: 'freestyle', event: 'Slopestyle final', type: 'Freeski herrar' },

            // Skidskytte (8-21 feb)
            { date: '2026-02-08', time: '14:05', sport: 'biathlon', event: 'Mixedstafett', type: 'Skidskytte' },
            { date: '2026-02-10', time: '13:30', sport: 'biathlon', event: 'Distans 20 km', type: 'Skidskytte herrar' },
            { date: '2026-02-11', time: '14:15', sport: 'biathlon', event: 'Distans 15 km', type: 'Skidskytte damer' },
            { date: '2026-02-13', time: '14:00', sport: 'biathlon', event: 'Sprint 10 km', type: 'Skidskytte herrar' },
            { date: '2026-02-14', time: '14:00', sport: 'biathlon', event: 'Sprint 7,5 km', type: 'Skidskytte damer' },
            { date: '2026-02-15', time: '11:15', sport: 'biathlon', event: 'Jaktstart 12,5 km', type: 'Skidskytte herrar' },
            { date: '2026-02-15', time: '14:45', sport: 'biathlon', event: 'Jaktstart 10 km', type: 'Skidskytte damer' },
            { date: '2026-02-18', time: '14:30', sport: 'biathlon', event: 'Stafett 4x7,5 km', type: 'Skidskytte herrar' },
            { date: '2026-02-19', time: '14:30', sport: 'biathlon', event: 'Stafett 4x6 km', type: 'Skidskytte damer' },
            { date: '2026-02-20', time: '14:30', sport: 'biathlon', event: 'Masstart 15 km', type: 'Skidskytte herrar' },
            { date: '2026-02-21', time: '14:30', sport: 'biathlon', event: 'Masstart 12,5 km', type: 'Skidskytte damer' },

            // Snowboard Big Air Damer (8-9 feb)
            { date: '2026-02-08', time: '19:30', sport: 'snowboard', event: 'Big Air kval', type: 'Snowboard damer' },
            { date: '2026-02-09', time: '19:30', sport: 'snowboard', event: 'Big Air final', type: 'Snowboard damer' },

            // Puckelpist / Freestyle Moguls (10 feb)
            { date: '2026-02-10', time: '11:15', sport: 'freestyle', event: 'Puckelpist kval', type: 'Freestyle herrar' },
            { date: '2026-02-10', time: '19:30', sport: 'freestyle', event: 'Puckelpist final', type: 'Freestyle herrar (Wallberg)' },

            // Backhoppning (10-16 feb)
            { date: '2026-02-10', time: '18:45', sport: 'jumping', event: 'Mixed team', type: 'Backhoppning' },
            { date: '2026-02-11', time: '18:45', sport: 'jumping', event: 'Normalbacke', type: 'Backhoppning damer' },
            { date: '2026-02-13', time: '18:45', sport: 'jumping', event: 'Normalbacke', type: 'Backhoppning herrar' },
            { date: '2026-02-15', time: '18:45', sport: 'jumping', event: 'Stora backen', type: 'Backhoppning herrar' },
            { date: '2026-02-16', time: '19:00', sport: 'jumping', event: 'Super team', type: 'Backhoppning herrar' },

            // Nordisk kombination (11-17 feb)
            { date: '2026-02-11', time: '10:00', sport: 'jumping', event: 'Gundersen normalbacke + 10km', type: 'Nordisk komb. herrar' },
            { date: '2026-02-14', time: '10:00', sport: 'jumping', event: 'Gundersen normalbacke + 5km', type: 'Nordisk komb. damer' },
            { date: '2026-02-17', time: '10:00', sport: 'jumping', event: 'Gundersen stora backen + 10km', type: 'Nordisk komb. herrar' },

            // Snowboard Halfpipe (11-13 feb)
            { date: '2026-02-11', time: '10:30', sport: 'snowboard', event: 'Halfpipe kval', type: 'Snowboard damer' },
            { date: '2026-02-11', time: '19:30', sport: 'snowboard', event: 'Halfpipe kval', type: 'Snowboard herrar' },
            { date: '2026-02-12', time: '19:30', sport: 'snowboard', event: 'Halfpipe final', type: 'Snowboard damer' },
            { date: '2026-02-13', time: '19:30', sport: 'snowboard', event: 'Halfpipe final', type: 'Snowboard herrar' },

            // Curling Damer (11-18 feb)
            { date: '2026-02-11', time: '09:05', sport: 'curling', event: 'USA ‚Äì Sverige', type: 'Damer' },
            { date: '2026-02-11', time: '19:05', sport: 'curling', event: 'Sverige ‚Äì Japan', type: 'Damer' },
            { date: '2026-02-12', time: '14:05', sport: 'curling', event: 'Danmark ‚Äì Sverige', type: 'Damer' },
            { date: '2026-02-13', time: '09:05', sport: 'curling', event: 'Sverige ‚Äì Kanada', type: 'Damer' },
            { date: '2026-02-14', time: '14:05', sport: 'curling', event: 'Sverige ‚Äì Schweiz', type: 'Damer' },
            { date: '2026-02-15', time: '14:05', sport: 'curling', event: 'Sydkorea ‚Äì Sverige', type: 'Damer' },
            { date: '2026-02-16', time: '09:05', sport: 'curling', event: 'Sverige ‚Äì Kina', type: 'Damer' },
            { date: '2026-02-17', time: '09:05', sport: 'curling', event: 'Storbritannien ‚Äì Sverige', type: 'Damer' },
            { date: '2026-02-18', time: '09:05', sport: 'curling', event: 'Sverige ‚Äì Norge', type: 'Damer' },

            // Curling Herrar (10-18 feb)
            { date: '2026-02-10', time: '19:05', sport: 'curling', event: 'Sverige ‚Äì Italien', type: 'Herrar' },
            { date: '2026-02-11', time: '14:05', sport: 'curling', event: 'Storbritannien ‚Äì Sverige', type: 'Herrar' },
            { date: '2026-02-12', time: '19:05', sport: 'curling', event: 'Kanada ‚Äì Sverige', type: 'Herrar' },
            { date: '2026-02-13', time: '14:05', sport: 'curling', event: 'Sverige ‚Äì USA', type: 'Herrar' },
            { date: '2026-02-14', time: '09:05', sport: 'curling', event: 'Norge ‚Äì Sverige', type: 'Herrar' },
            { date: '2026-02-15', time: '09:05', sport: 'curling', event: 'Sverige ‚Äì Kina', type: 'Herrar' },
            { date: '2026-02-16', time: '14:05', sport: 'curling', event: 'Schweiz ‚Äì Sverige', type: 'Herrar' },
            { date: '2026-02-17', time: '14:05', sport: 'curling', event: 'Sverige ‚Äì Danmark', type: 'Herrar' },
            { date: '2026-02-18', time: '14:05', sport: 'curling', event: 'Japan ‚Äì Sverige', type: 'Herrar' },

            // Hockey Herrar (12-16 feb)
            { date: '2026-02-12', time: '12:10', sport: 'hockey', event: 'Finland ‚Äì Sverige', type: 'Herrar gruppspel' },
            { date: '2026-02-14', time: '12:10', sport: 'hockey', event: 'Sverige ‚Äì Slovakien', type: 'Herrar gruppspel' },
            { date: '2026-02-16', time: '12:10', sport: 'hockey', event: 'Sverige ‚Äì Italien', type: 'Herrar gruppspel' },

            // Alpint - Storslalom & Slalom (14-18 feb)
            { date: '2026-02-14', time: '10:00', sport: 'alpine', event: 'Storslalom √•k 1', type: 'Alpint herrar (Jakobsen)' },
            { date: '2026-02-14', time: '13:30', sport: 'alpine', event: 'Storslalom √•k 2', type: 'Alpint herrar' },
            { date: '2026-02-15', time: '10:00', sport: 'alpine', event: 'Storslalom √•k 1', type: 'Alpint damer (Hector)' },
            { date: '2026-02-15', time: '13:30', sport: 'alpine', event: 'Storslalom √•k 2', type: 'Alpint damer (Hector)' },
            { date: '2026-02-16', time: '10:00', sport: 'alpine', event: 'Slalom √•k 1', type: 'Alpint herrar (Jakobsen)' },
            { date: '2026-02-16', time: '13:30', sport: 'alpine', event: 'Slalom √•k 2', type: 'Alpint herrar' },
            { date: '2026-02-18', time: '10:00', sport: 'alpine', event: 'Slalom √•k 1', type: 'Alpint damer (Swenn Larsson)' },
            { date: '2026-02-18', time: '13:30', sport: 'alpine', event: 'Slalom √•k 2', type: 'Alpint damer' },

            // Snowboard Slopestyle (17-18 feb)
            { date: '2026-02-17', time: '10:30', sport: 'snowboard', event: 'Slopestyle kval', type: 'Snowboard damer' },
            { date: '2026-02-17', time: '14:00', sport: 'snowboard', event: 'Slopestyle kval', type: 'Snowboard herrar' },
            { date: '2026-02-18', time: '12:30', sport: 'snowboard', event: 'Slopestyle final', type: 'Snowboard herrar' },

            // Freeski Big Air (18-19 feb)
            { date: '2026-02-18', time: '19:30', sport: 'freestyle', event: 'Big Air kval', type: 'Freeski herrar' },
            { date: '2026-02-19', time: '12:30', sport: 'freestyle', event: 'Big Air final', type: 'Freeski herrar' },

            // Skicross (20-21 feb)
            { date: '2026-02-20', time: '10:00', sport: 'freestyle', event: 'Skicross kval', type: 'Freestyle herrar' },
            { date: '2026-02-20', time: '13:00', sport: 'freestyle', event: 'Skicross final', type: 'Freestyle herrar' },
            { date: '2026-02-21', time: '10:00', sport: 'freestyle', event: 'Skicross kval', type: 'Freestyle damer (N√§slund)' },
            { date: '2026-02-21', time: '12:00', sport: 'freestyle', event: 'Skicross final', type: 'Freestyle damer (N√§slund)' },

            // Rodel (7-10 feb) - Svante & Tove Kohala
            { date: '2026-02-07', time: '17:00', sport: 'luge', event: 'Singel √•k 1-2', type: 'Rodel herrar (S. Kohala)' },
            { date: '2026-02-08', time: '17:00', sport: 'luge', event: 'Singel √•k 3-4 final', type: 'Rodel herrar (S. Kohala)' },
            { date: '2026-02-09', time: '17:00', sport: 'luge', event: 'Singel √•k 1-2', type: 'Rodel damer (T. Kohala)' },
            { date: '2026-02-10', time: '17:00', sport: 'luge', event: 'Singel √•k 3-4 final', type: 'Rodel damer (T. Kohala)' },

            // Konst√•kning (9-13 feb) - Nordeb√§ck, Majorov/Reitan
            { date: '2026-02-09', time: '19:20', sport: 'figureskating', event: 'Isdans rytmdans', type: 'Konst√•kning (Majorov/Reitan)' },
            { date: '2026-02-10', time: '18:30', sport: 'figureskating', event: 'Singel kortprogram', type: 'Konst√•kning herrar (Nordeb√§ck)' },
            { date: '2026-02-11', time: '19:30', sport: 'figureskating', event: 'Isdans fritt program', type: 'Konst√•kning (Majorov/Reitan)' },
            { date: '2026-02-13', time: '19:00', sport: 'figureskating', event: 'Singel fritt program', type: 'Konst√•kning herrar (Nordeb√§ck)' },

            // Parallell puckelpist / Dual Moguls (14-15 feb)
            { date: '2026-02-14', time: '10:30', sport: 'freestyle', event: 'Parallell puckelpist final', type: 'Freestyle damer' },
            { date: '2026-02-15', time: '10:30', sport: 'freestyle', event: 'Parallell puckelpist final', type: 'Freestyle herrar (Wallberg)' },

            // Finaler
            { date: '2026-02-19', time: '19:10', sport: 'hockey', event: 'OS-final', type: 'Hockey damer' },
            { date: '2026-02-20', time: '14:05', sport: 'curling', event: 'OS-final', type: 'Curling damer' },
            { date: '2026-02-21', time: '14:05', sport: 'curling', event: 'OS-final', type: 'Curling herrar' },
            { date: '2026-02-22', time: '14:10', sport: 'hockey', event: 'OS-final', type: 'Hockey herrar' },
        ];

        let currentOlympicsFilter = 'all';
        let currentOlympicsDateFilter = 'all';
        let olympicsShowAll = false;

        // Ladda sparade notis-val fr√•n localStorage
        function getNotifyEvents() {
            try {
                return JSON.parse(localStorage.getItem('dag365_notify_events') || '[]');
            } catch { return []; }
        }

        function saveNotifyEvents(events) {
            localStorage.setItem('dag365_notify_events', JSON.stringify(events));
        }

        function toggleEventNotify(eventId) {
            let notifyEvents = getNotifyEvents();
            if (notifyEvents.includes(eventId)) {
                notifyEvents = notifyEvents.filter(e => e !== eventId);
            } else {
                notifyEvents.push(eventId);
            }
            saveNotifyEvents(notifyEvents);
            renderOlympics();
        }

        function getEventId(event) {
            return `${event.date}_${event.time}_${event.sport}`;
        }

        function renderOlympics() {
            const grid = document.getElementById('olympics-grid');
            const toggleBtn = document.getElementById('olympics-show-all');
            const now = new Date();
            const notifyEvents = getNotifyEvents();

            // Populera dag-dropdown med unika datum
            const dateSelect = document.getElementById('olympics-date-filter');
            const uniqueDates = [...new Set(olympicsEvents.map(e => e.date))].sort();
            const dayNames = ['s√∂n', 'm√•n', 'tis', 'ons', 'tor', 'fre', 'l√∂r'];

            if (dateSelect.options.length <= 1) {
                uniqueDates.forEach(date => {
                    const d = new Date(date + 'T12:00:00');
                    const label = `${dayNames[d.getDay()]} ${d.getDate()}/${d.getMonth() + 1}`;
                    const option = document.createElement('option');
                    option.value = date;
                    option.textContent = label;
                    dateSelect.appendChild(option);
                });
            }
            dateSelect.value = currentOlympicsDateFilter;

            // Filtrera och sortera events
            let events = olympicsEvents
                .filter(e => currentOlympicsFilter === 'all' || e.sport === currentOlympicsFilter)
                .filter(e => currentOlympicsDateFilter === 'all' || e.date === currentOlympicsDateFilter)
                .map(e => {
                    const eventDate = new Date(`${e.date}T${e.time}:00`);
                    const endDate = new Date(eventDate.getTime() + 2 * 60 * 60 * 1000);
                    return { ...e, eventDate, endDate, id: getEventId(e) };
                })
                .sort((a, b) => a.eventDate - b.eventDate);

            // Hitta live och kommande events
            const liveEvents = events.filter(e => now >= e.eventDate && now <= e.endDate);
            const upcomingEvents = events.filter(e => e.eventDate > now);
            const pastEvents = events.filter(e => e.endDate < now);

            // Best√§m vilka som ska visas
            let displayEvents;
            if (olympicsShowAll) {
                displayEvents = [...liveEvents, ...upcomingEvents];
                grid.classList.add('expanded');
                toggleBtn.textContent = 'Visa f√§rre ‚ñ≤';
            } else {
                displayEvents = [...liveEvents, ...upcomingEvents].slice(0, 6);
                grid.classList.remove('expanded');
                toggleBtn.textContent = `Visa hela schemat (${upcomingEvents.length} t√§vlingar) ‚ñº`;
            }

            if (displayEvents.length === 0) {
                const recentPast = pastEvents.slice(-3);
                if (recentPast.length > 0) {
                    grid.innerHTML = recentPast.map(e => createOlympicsCard(e, now, true, notifyEvents)).join('');
                } else {
                    grid.innerHTML = `<div class="olympics-card"><div class="olympics-event">Inga fler svenska t√§vlingar i OS 2026</div></div>`;
                }
                toggleBtn.style.display = 'none';
                return;
            }

            toggleBtn.style.display = upcomingEvents.length > 6 ? 'inline-block' : 'none';
            grid.innerHTML = displayEvents.map(e => createOlympicsCard(e, now, false, notifyEvents)).join('');

            // L√§gg till event listeners f√∂r notis-knappar
            grid.querySelectorAll('.notify-toggle').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleEventNotify(btn.dataset.eventId);
                });
            });
        }

        function createOlympicsCard(event, now, isPast, notifyEvents) {
            const isLive = now >= event.eventDate && now <= event.endDate;
            const isToday = event.eventDate.toDateString() === now.toDateString();
            const isNotifyOn = notifyEvents.includes(event.id);

            const sportIcons = {
                hockey: 'üèí',
                curling: 'ü•å',
                skiing: '‚õ∑Ô∏è',
                alpine: 'üèîÔ∏è',
                freestyle: 'üéø',
                snowboard: 'üèÇ',
                jumping: 'ü¶Ö',
                biathlon: 'üéØ',
                figureskating: '‚õ∏Ô∏è',
                luge: 'üõ∑'
            };

            const dayNames = ['s√∂n', 'm√•n', 'tis', 'ons', 'tor', 'fre', 'l√∂r'];
            const dateStr = `${dayNames[event.eventDate.getDay()]} ${event.eventDate.getDate()}/${event.eventDate.getMonth() + 1}`;

            let cardClass = 'olympics-card';
            if (isLive) cardClass += ' live';
            else if (isToday) cardClass += ' today';

            const notifyBtn = !isPast ? `
                <button class="notify-toggle ${isNotifyOn ? 'active' : ''}"
                        data-event-id="${event.id}"
                        title="${isNotifyOn ? 'Notis p√• - klicka f√∂r att st√§nga av' : 'Klicka f√∂r p√•minnelse'}">
                    ${isNotifyOn ? 'üîî' : 'üîï'}
                </button>
            ` : '';

            return `
                <div class="${cardClass}">
                    ${notifyBtn}
                    <div class="olympics-date">${isPast ? 'Avslutad' : dateStr}</div>
                    <div class="olympics-time">${event.time}</div>
                    <div class="olympics-sport">${sportIcons[event.sport] || ''} ${event.type}</div>
                    <div class="olympics-event">${event.event}</div>
                </div>
            `;
        }

        // Olympics filter click handlers
        document.querySelectorAll('.olympics-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.olympics-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentOlympicsFilter = btn.dataset.sport;
                renderOlympics();
            });
        });

        // Olympics date filter handler
        document.getElementById('olympics-date-filter').addEventListener('change', (e) => {
            currentOlympicsDateFilter = e.target.value;
            renderOlympics();
        });

        // Visa alla/f√§rre toggle
        document.getElementById('olympics-show-all').addEventListener('click', () => {
            olympicsShowAll = !olympicsShowAll;
            renderOlympics();
        });

        // Initialize Olympics
        renderOlympics();
        // Update every minute
        setInterval(renderOlympics, 60000);

        // ============ PWA / SERVICE WORKER ============
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('dag365: Service Worker registered', registration.scope);
                    })
                    .catch((error) => {
                        console.log('dag365: Service Worker registration failed', error);
                    });
            });
        }
        
        // PWA Install prompt
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // F√∂rhindra att Chrome visar sin egen prompt
            e.preventDefault();
            deferredPrompt = e;
            // Visa v√•r installationsknapp
            installBtn.classList.add('show');
        });
        
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            // Visa installationsprompt
            deferredPrompt.prompt();
            
            const { outcome } = await deferredPrompt.userChoice;
            console.log('dag365: Install prompt outcome:', outcome);
            
            // Rensa - kan bara anv√§ndas en g√•ng
            deferredPrompt = null;
            installBtn.classList.remove('show');
        });
        
        // D√∂lj knappen om redan installerad
        window.addEventListener('appinstalled', () => {
            console.log('dag365: App installed');
            installBtn.classList.remove('show');
            deferredPrompt = null;
        });

        // ============ FIREBASE PUSH NOTIFICATIONS ============

        const VAPID_KEY = 'BHvKw4y_tYRL1PVuWcdv18esdk_9_8az61Z057TI3C85nRXw-1lUAzXfmvCW1l96AEsOQ-hnyI86iQNs3zGM_3g';
        const notifyBtn = document.getElementById('notify-btn');
        let firebaseApp = null;
        let messaging = null;
        let firestoreDb = null;

        // iOS-detektion och standalone-kontroll
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }

        function isStandalone() {
            return window.navigator.standalone === true ||
                   window.matchMedia('(display-mode: standalone)').matches;
        }

        function isIOSInSafari() {
            return isIOS() && !isStandalone();
        }

        // Ladda Firebase dynamiskt
        async function loadFirebase() {
            if (firebaseApp) return true;

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js');
                const { getMessaging, getToken, onMessage } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging.js');
                const { getFirestore, doc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');

                const firebaseConfig = {
                    apiKey: "AIzaSyDUGbZDv4R4kPHCZez0Xsf5_iv3vqaYhYE",
                    authDomain: "dag365-2065b.firebaseapp.com",
                    projectId: "dag365-2065b",
                    storageBucket: "dag365-2065b.firebasestorage.app",
                    messagingSenderId: "213756811848",
                    appId: "1:213756811848:web:e7098e7880ad4fa96d167d"
                };

                firebaseApp = initializeApp(firebaseConfig);
                messaging = getMessaging(firebaseApp);
                firestoreDb = getFirestore(firebaseApp);

                onMessage(messaging, (payload) => {
                    console.log('dag365: F√∂rgrunds-notis mottagen', payload);
                    showLocalNotification(payload);
                });

                return true;
            } catch (error) {
                console.error('dag365: Kunde inte ladda Firebase', error);
                return false;
            }
        }

        // Spara prenumeration till Firestore
        async function saveSubscriptionToFirestore(token, events) {
            if (!firestoreDb) {
                await loadFirebase();
            }
            if (!firestoreDb) return;

            try {
                const { doc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                await setDoc(doc(firestoreDb, 'subscribers', token), {
                    token: token,
                    events: events,
                    updatedAt: new Date().toISOString()
                });
                console.log('dag365: Prenumeration sparad till Firestore');
            } catch (error) {
                console.error('dag365: Kunde inte spara till Firestore', error);
            }
        }

        // Synka valda t√§vlingar till Firestore
        async function syncNotifyEventsToFirestore() {
            const token = localStorage.getItem('dag365_fcm_token');
            if (!token) return;

            const events = getNotifyEvents();
            await saveSubscriptionToFirestore(token, events);
        }

        // Uppdatera toggleEventNotify f√∂r att synka till Firestore
        toggleEventNotify = async function(eventId) {
            const token = localStorage.getItem('dag365_fcm_token');

            // Om notiser inte √§r aktiverade, visa meddelande
            if (!token || Notification.permission !== 'granted') {
                alert('Du beh√∂ver aktivera notiser f√∂rst!\n\nKlicka p√• "üîî Aktivera notiser" l√§ngst upp.');
                return;
            }

            let notifyEvents = getNotifyEvents();
            const wasOn = notifyEvents.includes(eventId);

            if (wasOn) {
                notifyEvents = notifyEvents.filter(e => e !== eventId);
            } else {
                notifyEvents.push(eventId);
            }
            saveNotifyEvents(notifyEvents);
            renderOlympics();

            // Synka till Firestore
            try {
                await syncNotifyEventsToFirestore();
                console.log('dag365: Event-notis togglad:', eventId, wasOn ? 'AV' : 'P√Ö');
            } catch (error) {
                console.error('dag365: Kunde inte synka till Firestore:', error);
            }
        };

        // Visa lokal notis (st√∂djer b√•de data-only och notification-meddelanden)
        function showLocalNotification(payload) {
            const data = payload.data || {};
            const notification = payload.notification || {};
            const title = data.title || notification.title || 'üá∏üá™ Sverige t√§vlar!';
            const body = data.body || notification.body || '';

            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '/icon-192.png',
                    badge: '/icon-192.png'
                });
            }
        }

        // Kontrollera notis-status och uppdatera knapp
        function updateNotifyButton() {
            const token = localStorage.getItem('dag365_fcm_token');

            // iOS i Safari (inte installerad som app) - visa installationsinstruktioner
            if (isIOSInSafari()) {
                notifyBtn.innerHTML = 'üì≤ Installera f√∂r notiser';
                notifyBtn.classList.add('show');
                notifyBtn.classList.remove('notify-active', 'notify-denied');
                notifyBtn.title = 'Installera appen f√∂r att f√• push-notiser p√• iOS';
                return;
            }

            if (!('Notification' in window)) {
                notifyBtn.style.display = 'none';
                return;
            }

            // Ta bort gamla klasser
            notifyBtn.classList.remove('notify-active', 'notify-denied');
            notifyBtn.style.opacity = '1';

            if (Notification.permission === 'granted' && token) {
                notifyBtn.innerHTML = 'üîî <span style="color: #90EE90;">‚óè</span> Notiser P√Ö';
                notifyBtn.classList.add('show', 'notify-active');
                notifyBtn.title = 'Notiser √§r aktiverade! Klicka f√∂r att skicka testnotis.';
            } else if (Notification.permission === 'denied') {
                notifyBtn.innerHTML = 'üîï Blockerade';
                notifyBtn.classList.add('show', 'notify-denied');
                notifyBtn.title = 'Notiser √§r blockerade i webbl√§saren. √Ñndra i inst√§llningar.';
            } else {
                notifyBtn.innerHTML = 'üîî Aktivera notiser';
                notifyBtn.classList.add('show');
                notifyBtn.title = 'Klicka f√∂r att aktivera OS-notiser';
            }
        }

        // Beg√§r till√•telse och registrera token
        async function requestNotificationPermission() {
            try {
                const registration = await navigator.serviceWorker.register('/sw.js');
                console.log('dag365: Service Worker registrerad', registration);

                const loaded = await loadFirebase();
                if (!loaded) {
                    alert('Kunde inte ladda notis-tj√§nsten. F√∂rs√∂k igen.');
                    return;
                }

                const permission = await Notification.requestPermission();
                console.log('dag365: Notis-till√•telse:', permission);

                if (permission !== 'granted') {
                    alert('Du beh√∂ver till√•ta notiser f√∂r att f√• OS-uppdateringar.');
                    updateNotifyButton();
                    return;
                }

                const { getToken } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging.js');
                const token = await getToken(messaging, {
                    vapidKey: VAPID_KEY,
                    serviceWorkerRegistration: registration
                });

                if (token) {
                    console.log('dag365: FCM Token:', token);
                    localStorage.setItem('dag365_fcm_token', token);

                    // Spara till Firestore med valda t√§vlingar
                    const events = getNotifyEvents();
                    await saveSubscriptionToFirestore(token, events);

                    alert('üéâ Notiser aktiverade!\n\nV√§lj t√§vlingar du vill bli p√•mind om genom att klicka p√• üîï vid varje t√§vling.');
                } else {
                    console.error('dag365: Ingen token mottagen');
                    alert('Kunde inte aktivera notiser. F√∂rs√∂k igen.');
                }

                updateNotifyButton();

            } catch (error) {
                console.error('dag365: Notis-fel:', error);
                alert('N√•got gick fel: ' + error.message);
            }
        }

        // St√§ng av notiser
        async function disableNotifications() {
            const token = localStorage.getItem('dag365_fcm_token');

            // Ta bort fr√•n Firestore
            if (token && firestoreDb) {
                try {
                    const { doc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                    await deleteDoc(doc(firestoreDb, 'subscribers', token));
                    console.log('dag365: Prenumeration borttagen fr√•n Firestore');
                } catch (error) {
                    console.error('dag365: Kunde inte ta bort fr√•n Firestore', error);
                }
            }

            // Ta bort lokalt
            localStorage.removeItem('dag365_fcm_token');
            localStorage.removeItem('dag365_notify_events');

            updateNotifyButton();
            renderOlympics();
        }

        // Notis-knapp klick
        notifyBtn.addEventListener('click', async () => {
            // iOS i Safari - visa installationsinstruktioner
            if (isIOSInSafari()) {
                alert(
                    'üì≤ Installera dag365 p√• din hemsk√§rm\n\n' +
                    'Push-notiser p√• iOS kr√§ver att appen √§r installerad:\n\n' +
                    '1. Tryck p√• dela-knappen (‚ñ¢‚Üë) l√§ngst ner\n' +
                    '2. Scrolla ner och v√§lj "L√§gg till p√• hemsk√§rmen"\n' +
                    '3. Tryck "L√§gg till"\n' +
                    '4. √ñppna appen fr√•n hemsk√§rmen\n' +
                    '5. Aktivera notiser!\n\n' +
                    'OBS: Kr√§ver iOS 16.4 eller senare.'
                );
                return;
            }

            const token = localStorage.getItem('dag365_fcm_token');

            if (Notification.permission === 'granted' && token) {
                // Visa meny med alternativ
                const choice = prompt(
                    'Notiser √§r aktiverade! ‚úÖ\n\n' +
                    'V√§lj alternativ:\n' +
                    '1 = Skicka testnotis\n' +
                    '2 = St√§ng av notiser\n\n' +
                    'Skriv 1 eller 2:'
                );

                if (choice === '1') {
                    // Skicka testnotis via Firestore-trigger (kringg√•r IAM)
                    try {
                        await loadFirebase();
                        const { collection, addDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                        await addDoc(collection(firestoreDb, 'testNotifications'), {
                            token: token,
                            createdAt: new Date().toISOString()
                        });
                        console.log('Testnotis beg√§rd!');
                        alert('Testnotis skickas inom n√•gra sekunder!');
                    } catch (e) {
                        console.error('Testnotis fel:', e);
                        alert('Kunde inte skicka testnotis: ' + e.message);
                    }
                } else if (choice === '2') {
                    if (confirm('√Ñr du s√§ker p√• att du vill st√§nga av notiser?')) {
                        await disableNotifications();
                        alert('Notiser avst√§ngda.');
                    }
                }
            } else {
                await requestNotificationPermission();
            }
        });

        // Initiera notis-knapp
        updateNotifyButton();

        // Day info popup f√∂r mobil
        const dayInfoPopup = document.createElement('div');
        dayInfoPopup.className = 'day-info-popup';
        dayInfoPopup.innerHTML = '<div class="date"></div><div class="info"></div>';
        document.body.appendChild(dayInfoPopup);

        let popupTimeout;

        function showDayInfo(dayCell, date, month, year) {
            const holiday = getHoliday(year, month, date);
            const themeDay = getThemeDay(year, month, date);

            if (!holiday && !themeDay) return;

            const dateObj = new Date(year, month, date);
            const dayNames = ['S√∂ndag', 'M√•ndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'L√∂rdag'];
            const monthNames = ['januari', 'februari', 'mars', 'april', 'maj', 'juni',
                               'juli', 'augusti', 'september', 'oktober', 'november', 'december'];

            const dateStr = `${dayNames[dateObj.getDay()]} ${date} ${monthNames[month]} ${year}`;

            let infoHtml = '';
            if (holiday) {
                infoHtml += `<span class="holiday-text">üî¥ ${holiday}</span>`;
            }
            if (themeDay) {
                if (infoHtml) infoHtml += '<br>';
                infoHtml += `<span class="themeday-text">${themeDay.icon} ${themeDay.name}</span>`;
            }

            dayInfoPopup.querySelector('.date').textContent = dateStr;
            dayInfoPopup.querySelector('.info').innerHTML = infoHtml;
            dayInfoPopup.classList.add('show');

            clearTimeout(popupTimeout);
            popupTimeout = setTimeout(() => {
                dayInfoPopup.classList.remove('show');
            }, 3000);
        }

        // L√§gg till klick-handler p√• kalendern
        document.getElementById('year-calendar').addEventListener('click', (e) => {
            const dayCell = e.target.closest('.day-cell');
            if (!dayCell || dayCell.classList.contains('empty')) return;

            const weekRow = dayCell.parentElement;
            const weeksContainer = weekRow.parentElement;
            const monthCard = weeksContainer.parentElement;
            const monthCards = Array.from(document.querySelectorAll('.month-card'));
            const monthIndex = monthCards.indexOf(monthCard);

            const dayNum = parseInt(dayCell.textContent);
            if (!isNaN(dayNum)) {
                showDayInfo(dayCell, dayNum, monthIndex, displayYear);
            }
        });

        // St√§ng popup vid klick utanf√∂r
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.day-cell') && !e.target.closest('.day-info-popup')) {
                dayInfoPopup.classList.remove('show');
            }
        });
    </script>
</body>
</html>